/******  Copyright 2016 Tradable ApS; @license MIT; v1.19.3  ******/
function isGreaterOrEqualMinVersion(e,n){return this.toNum=function(e){return parseInt(e,10)},this.highest=function(e,n){for(var t=e.split(".").map(this.toNum),o=n.split(".").map(this.toNum),r=0;r<t.length;r++)if(t[r]!==o[r])return t[r]>o[r]?e:n;return o.length>t.length?n:void 0},!("undefined"!=typeof highest(e,n)&&highest(e,n)===n)}"undefined"!=typeof console&&"undefined"!=typeof console.log||(console={log:function(){},warn:function(){}}),"undefined"==typeof jQuery?console.warn("tradable requires jQuery to run"):isGreaterOrEqualMinVersion(jQuery.fn.jquery,"2.1.4")||console.warn("tradable requires jQuery version 2.1.4 or above");var trEmbJQ=jQuery.noConflict(!0),jsGlobalObject="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:this;!function(e,n){"use strict";function t(){function e(e,n){n.tradingEnabled=!1,u()&&localStorage.setItem("tradingEnabled:"+_,!1);var t=o(e);return t.accessToken&&t.endPoint?(n.enableTrading(t.accessToken,t.endPoint,t.expiresIn),"osLaunch"===window.name&&window.close(),!0):!1}var t=!1,r=window.opener;if(r&&"osBrokerSignUp"===window.name)window.close();else if(r&&"osLaunch"===window.name){var c=window.location.hash;if(c){try{r.postMessage("replace your location","*"),t=e(c,r.tradable)}catch(i){t=!1}t||(t=e(c,Y))}}else window.location.hash&&-1!==window.location.hash.indexOf("access_token")&&-1!==window.location.hash.indexOf("endpointURL")&&-1!==window.location.hash.indexOf("expires_in")?t=e(window.location.hash,Y):Y.tradingEnabled&&(P(),t=!0);t||(console.log("Initiating without authentication..."),n(document).ready(function(){R()}))}function o(e){var t={accessToken:void 0,endPoint:void 0,expiresIn:void 0},o=e.replace("#","").split("&");return n(o).each(function(e,n){var o=n.split("="),r=o[0],c=o[1];"access_token"===r?t.accessToken=c:"endpointURL"===r?t.endPoint=c:"expires_in"===r&&(t.expiresIn=c)}),t}function r(){var t="undefined"!=typeof e.tradableEmbedConfig?e.tradableEmbedConfig:e.tradableConfig;if("undefined"==typeof t){var o=0!==n("#tradable-embed").length?"#tradable-embed":0!==n("#tradable").length?"#tradable":"#tradable-api";t={appId:n(o).attr("data-app-id"),redirectURI:n(o).attr("data-redirect-uri"),customOAuthURL:n(o).attr("data-custom-oauth-url"),customOAuthHost:n(o).attr("data-custom-oauth-host")}}return t}function c(){var e=tradableConfig.redirectURI?tradableConfig.redirectURI:location.href;return encodeURIComponent(e)}function i(e){var n={},t=tradableConfig.customOAuthURL,o=tradableConfig.customOAuthHost,r="api.tradable.com/";_>2e5&&(r="api-staging.tradable.com/",console.log("Starting in staging mode...")),o&&(r=o);var c="https://"+r+"oauth/authorize?client_id="+_+"&scope=trade&response_type=token&redirect_uri="+e,i=t?t:c;return n.oauthHost=r,n.oauthURL=i,n}function a(){var e={};return e.token=localStorage.getItem("accessToken:"+_),e.authEndpoint=localStorage.getItem("authEndpoint:"+_),e.tradingEnabled=localStorage.getItem("tradingEnabled:"+_),e.expirationTimeUTC=localStorage.getItem("expirationTimeUTC:"+_),!e.tradingEnabled||e.authEndpoint&&e.token&&e.expirationTimeUTC||(e.tradingEnabled=!1,u()&&localStorage.setItem("tradingEnabled:"+_,e.tradingEnabled)),e}function u(){var e="test";try{return localStorage.setItem(e,"1"),localStorage.removeItem(e),!0}catch(n){return!1}}function s(e,n){var t=window.screenLeft?window.screenLeft:window.screenX,o=window.screenTop?window.screenTop:window.screenY,r=420,c=500,i=t+window.innerWidth/2-r/2,a=o+window.innerHeight/2-c/2;return window.open(e,n,"toolbar=no, titlebar=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+r+", height="+c+", top="+a+", left="+i)}function d(e){if("number"!=typeof e)return 0;var n=String(e).replace(",",".").split(".")[1];return n?n.length:0}function l(e,n){var t=!1;return Y.tradingEnabled&&(Y.tradingEnabled=!1,t=!0),v(),g().then(function(){return console.log("Instruments ready"),t&&(Y.tradingEnabled=!0,U()),e&&"function"==typeof e?e(Y.accounts):this},function(e){return n&&"function"==typeof n?n(e):this})}function f(e,n){return p(Y.selectedAccountId,e,n)}function p(e,n,t){return Y.makeAccountRequest("GET",e,"instruments/",null,n,t)}function m(){return"FULL_INSTRUMENT_LIST"===Y.selectedAccount.instrumentRetrieval}function h(e){var t=!0;return n(Y.accounts).each(function(n,o){o.uniqueId===e&&"FULL_INSTRUMENT_LIST"!==o.instrumentRetrieval&&(t=!1)}),t}function g(){var e=new n.Deferred;return m()?f().then(function(n){b(n),e.resolve(Y.availableInstruments)},function(n){e.reject(n)}):($=[],Y.searchInstruments("EUR").then(function(e){return A(e),Y.searchInstruments("AUD")}).then(function(e){return A(e),Y.searchInstruments("USD")}).then(function(e){return A(e),Y.getPrices($)}).then(function(){e.resolve(Y.availableInstruments)},function(n){e.reject(n)})),e}function A(e){var t=0;n(e).each(function(e,n){(6===n.symbol.length||7===n.symbol.length)&&16>t&&($.push(n.instrumentId),t++)})}function v(){Y.availableCategories.splice(0,Y.availableCategories.length),Y.availableInstruments.splice(0,Y.availableInstruments.length),Y.availableSymbols.splice(0,Y.availableSymbols.length),Y.availableCurrencies.splice(0,Y.availableCurrencies.length),Z={}}function I(e){return"undefined"!=typeof Z[e]}function b(e){function t(e){var t=["100","200","225","spx","h33","nas","u30","e50","f40","d30","e35","i40","z30","s30","uso","uko"];-1===n.inArray(e,Y.availableCurrencies)&&-1===n.inArray(e,t)&&Y.availableCurrencies.push(e)}n(e).each(function(e,o){if(!I(o.instrumentId)){Y.availableInstruments.push(o),Y.availableSymbols.push(o.symbol);var r=o.symbol.replace("/","");if(("FOREX"===o.type||"CFD"===o.type)&&6===r.length){var c=r.toLowerCase().substring(0,3),i=r.toLowerCase().substring(3,6);t(c),t(i)}-1===n.inArray(o.type,Y.availableCategories)&&Y.availableCategories.push(o.type),Z[o.instrumentId]=!0}})}function y(e){var t=[];return n(e).each(function(e,n){I(n)||t.push(n)}),t}function T(){Y.instrumentKeysForAccountUpdates.length&&Y.instrumentKeysForAccountUpdates.splice(0,Y.instrumentKeysForAccountUpdates.length)}function O(e,n){Y.excludeCurrentAccount(),Y.accounts.length>0?P():Y.signOut(),e&&e(n)}function P(){console.log("Validating token..."),Y.getAccounts().then(function(){Y.enableTrading(Y.accessToken,Y.authEndpoint)},function(){E(!1)})}function k(e,t){var o=new n.Deferred;console.log("Accounts initialized");var r,c=localStorage.getItem("selectedAccount:"+_),i=Y.accounts.length-1;return e&&Y.accounts.length>t?r=Y.accounts[i].uniqueId:c&&Y.accountMap[c]?r=c:i>=0&&(r=Y.accounts[i].uniqueId),T(),r?Y.setSelectedAccount(r,function(){Y.tradingEnabled||E(!0),o.resolve()},function(e){o.reject(e)}):(Y.signOut(),o.reject()),o}function E(e){Y.tradingEnabled=e,u()&&localStorage.setItem("tradingEnabled:"+_,Y.tradingEnabled),R()}function R(){n(Y.readyCallbacks).each(function(e,n){n()}),L("embedReady"),Y.notifiedCallbacks=!0}function S(){if(Y.tradingEnabled&&!ee&&(J.length>0||void 0!==typeof B.accountUpdated)){ee=!0;var e=[];n(Y.instrumentKeysForAccountUpdates).each(function(t,o){var r=o.substring(0,o.indexOf(":"));-1===n.inArray(r,e)&&e.push(r)}),Y.getSnapshot(e).then(function(e){return Y.lastSnapshot=e,w(e)}).then(function(e){n.each(J,function(n,t){t(e)}),L("accountUpdated",e),ee=!1},function(){ee=!1})}}function w(e){var t=new n.Deferred;if(m())t.resolve(e);else{var o=[],r=function(e,n){I(n.instrumentId)||o.push(n.instrumentId)};n(e.positions.open).each(r),n(e.orders.pending).each(r),o.length?Y.getInstrumentsFromIds(o).then(function(){t.resolve(e)}):t.resolve(e)}return t}function F(){E(!1),n(H).each(function(e,n){n()}),L("tokenExpired")}function C(e){n(X).each(function(n,t){t(e)}),L("error",e)}function U(){n(z).each(function(e,n){n()}),L("accountSwitch")}function q(){E(!1),L("reLoginRequired")}function L(e,n){if(Y.isEventValid(e)){if(void 0!==typeof B[e])for(var t in B[e])B[e].hasOwnProperty(t)&&("undefined"!=typeof n?B[e][t](n):B[e][t]())}else console.error("Careful, can't notify '"+e+"', it's an invalid event name")}function M(e,n,t){return n||t?e.then(function(e){return"function"==typeof n?n(e):void 0},function(e,n,o){return"function"==typeof t?t(e,n,o):void 0}):e.promise()}function x(){var e=new n.Deferred;if(Y.selectedAccount.brokerId<0&&1===Y.allAccounts.length)return e.resolve(),e;var t={tokenValue:Y.accessToken};return Y.makeOsRequest("internal","POST","","signOut",t).then(function(){e.resolve()},function(){e.reject()}),e}function D(e){var n,t,o=0;if(0===e.length)return o;for(n=0;n<e.length;n++)t=e.charCodeAt(n),o=(o<<5)-o+t,o&=o;return o}function N(){return-1!==navigator.userAgent.indexOf("MSIE")||/rv:11.0/i.test(navigator.userAgent)}e.tradableConfig=r();var _=tradableConfig.appId,j=c(),K=i(j),G=a(),W=["embedReady","accountUpdated","accountSwitch","tokenExpired","tokenWillExpire","reLoginRequired","error"],B={},z=[],J=[],V=[],H=[],Q=[],X=[],Y={version:"1.19.3",app_id:_,oauth_host:K.oauthHost,auth_loc:K.oauthURL,login_loc:K.oauthURL+"&showLogin=true",approval_page_loc:K.oauthURL+"&showApproval=true",broker_signup_loc:"https://"+K.oauthHost+"brokerSignup?client_id="+_+"&redirect_uri="+j,auth_window:null,authEndpoint:G.authEndpoint,accessToken:G.token,tradingEnabled:G.tradingEnabled,expirationTimeUTC:G.expirationTimeUTC,notifiedCallbacks:!1,readyCallbacks:[],allAccounts:[],accounts:[],accountIdsToExclude:[],accountMap:{},selectedAccount:null,selectedAccountId:null,availableCategories:[],availableInstruments:[],availableSymbols:[],availableCurrencies:[],lastSnapshot:null,instrumentKeysForAccountUpdates:[],accountUpdateMillis:700,showApprovalPage:function(){Y.openOAuthPage("APPROVAL",!0)},showApprovalPageInWindow:function(){Y.openOAuthPage("APPROVAL",!1)},authenticate:function(e){Y.tradingEnabled?P():Y.openOAuthPage("AUTHENTICATE",!0,e)},authenticateWithWindow:function(e){Y.openOAuthPage("AUTHENTICATE",!1,e)},showLoginPage:function(e){Y.openOAuthPage("LOGIN",!0,e)},showLoginPageInWindow:function(e){Y.openOAuthPage("LOGIN",!1,e)},showBrokerSignUpPage:function(){Y.openOAuthPage("BROKER_SIGNUP",!0)},showBrokerSignUpPageInWindow:function(){Y.openOAuthPage("BROKER_SIGNUP",!1)},openOAuthPage:function(e,n,t){var o="AUTHENTICATE"===e.toUpperCase()?Y.auth_loc:"LOGIN"===e.toUpperCase()?Y.login_loc:"APPROVAL"===e.toUpperCase()?Y.approval_page_loc:"BROKER_SIGNUP"===e.toUpperCase()?Y.broker_signup_loc:void 0;if(!o)throw"Choose a correct type: AUTHENTICATE, LOGIN, APPROVAL or BROKER_SIGNUP";if("undefined"!=typeof t&&(o=o+"&broker_id="+t),"undefined"!=typeof n&&n||N())location.href=o;else{var r="BROKER_SIGNUP"===e.toUpperCase()?"osBrokerSignUp":"osLaunch";Y.auth_window=s(o,r)}},enableWithAccessToken:function(e,n,t){return Y.enableTrading(e,n,t,!0)},signOut:function(){x(),u()&&(localStorage.removeItem("accessToken:"+_),localStorage.removeItem("authEndpoint:"+_),localStorage.removeItem("tradingEnabled:"+_),localStorage.removeItem("expirationTimeUTC:"+_)),Y.tradingEnabled=!1,R()},isEventValid:function(e){return"string"==typeof e&&-1!==n.inArray(e,W)},on:function(e,n,t){if(!Y.isEventValid(n))throw"Please provide a valid eventName: "+W;if(B[n]||(B[n]={}),"string"!=typeof e)throw"The given event namespace is invalid (needs to be a string)";if("undefined"!=typeof B[n][e])throw"The given event namespace is already taken, 'off' the event first to change it";if("function"!=typeof t)throw"Please provide a valid callback function";switch(n){case"embedReady":Y.initEmbedReady(t);break;case"accountUpdated":Y.initAccountUpdated();break;case"tokenWillExpire":Y.initTokenWillExpire()}B[n][e]=t},off:function(e,n){if("undefined"==typeof n)for(var t in B)B.hasOwnProperty(t)&&e in B[t]&&B[t].hasOwnProperty(e)&&delete B[t][e];else Y.isEventValid(n)&&B[n]&&e in B[n]&&delete B[n][e]},initEmbedReady:function(e){return Y.notifiedCallbacks?e():void 0},onEmbedReady:function(e){if(!e||"function"!=typeof e)throw"The specified callback is not a function";Y.readyCallbacks.push(e),Y.initEmbedReady(e)},accountUpdateInterval:null,initAccountUpdated:function(){null===Y.accountUpdateInterval&&(Y.accountUpdateInterval=setInterval(S,Y.accountUpdateMillis))},onAccountUpdated:function(e){if(!e||"function"!=typeof e)throw"The specified callback is not a function";Y.initAccountUpdated();var t=D(e.toString());-1===n.inArray(t,V)&&(J.push(e),V.push(t))},setAccountUpdateFrequencyMillis:function(e){if(!(e&&e>0&&"number"==typeof e))throw"Please specify a valid update frequency";Y.accountUpdateMillis=e,Y.accountUpdateInterval&&(clearInterval(Y.accountUpdateInterval),Y.accountUpdateInterval=setInterval(S,Y.accountUpdateMillis))},addSymbolToUpdates:function(e,n){console.warn("'addSymbolToUpdates' is now deprecated, 'addInstrumentIdToUpdates' should now be used instead."),Y.addInstrumentIdToUpdates(e,n)},removeSymbolFromUpdates:function(e,n){console.warn("'removeSymbolFromUpdates' is now deprecated, 'removeInstrumentIdFromUpdates' should now be used instead."),Y.removeInstrumentIdFromUpdates(e,n)},addInstrumentIdToUpdates:function(e,t){if(-1!==e.indexOf(":"))throw"It is not allowed to include a colon ':' in the updateClientId";var o=t+":"+e;-1===n.inArray(o,Y.instrumentKeysForAccountUpdates)&&Y.instrumentKeysForAccountUpdates.push(o)},removeInstrumentIdFromUpdates:function(e,t){var o=t+":"+e;Y.instrumentKeysForAccountUpdates=n.grep(Y.instrumentKeysForAccountUpdates,function(e){return e!==o})},onAccountSwitch:function(e){Y.saveCallback(e,z)},onTokenExpired:function(e){Y.saveCallback(e,H)},onError:function(e){Y.saveCallback(e,X)},saveCallback:function(e,t){e&&-1===n.inArray(e,t)&&t.push(e)},tokenWillExpireInterval:null,initTokenWillExpire:function(){function e(){var e=Y.getRemainingTokenMillis();e&&e>0&&18e5>e&&(n(Q).each(function(n,t){t(e)}),L("tokenWillExpire",e))}null===Y.tokenWillExpireInterval&&(Y.tokenWillExpireInterval=setInterval(e,3e5))},onTokenWillExpire:function(e){Y.initTokenWillExpire(),-1===n.inArray(e,Q)&&Q.push(e)},getRemainingTokenMillis:function(){return Y.expirationTimeUTC||console.log("You need to authenticate before calling this method"),Y.expirationTimeUTC-(new Date).getTime()},makeOsRequest:function(e,t,o,r,c,i,a){var u,s="internal"===e?"":"v1/";"user"!==e&&"accounts"!==e?u="https://"+Y.oauth_host:void 0!==o&&null!==o&&0===o.length?u=Y.authEndpoint:Y.accountMap[o]?u=Y.accountMap[o].endpointURL:console.info("Please specify a valid accountId or method");var d=n.ajax({type:t,beforeSend:function(n){"internal"!==e&&n.setRequestHeader("Authorization","Bearer "+Y.accessToken),n.setRequestHeader("x-tr-embed-sdk","js-"+Y.version)},crossDomain:!0,xhrFields:{withCredentials:!0},url:o&&o.length>0?u+s+e+"/"+o+"/"+r:u+s+e+"/"+r,contentType:"application/json; charset=utf-8",data:c?JSON.stringify(c):void 0,dataType:"json"});return d.then(function(){},function(e){e.responseJSON&&(403!==e.responseJSON.httpStatus&&502!==e.responseJSON.httpStatus||(!Y.initializingAccount&&Y.isReLoginRequired(e)?q():F()),C(e.responseJSON))}),M(d,i,a)},makeAccountRequest:function(e,n,t,o,r,c){return Y.makeOsRequest("accounts",e,n,t,o,r,c)},initializingAccount:!1,setSelectedAccount:function(e,n,t){return Y.accountMap[e]?(Y.lastSnapshot=void 0,Y.selectedAccount=Y.accountMap[e],Y.selectedAccountId=e,console.log("New accountId is set"),Y.initializingAccount=!0,l(function(){u()&&localStorage.setItem("selectedAccount:"+_,e),n&&n(),Y.initializingAccount=!1},function(n){Y.isReLoginRequired(n)?Y.reLogin().then(function(){Y.setSelectedAccount(e)},function(){O(t,n)}):502!==n.status&&500!==n.status&&403!==n.status||O(t,n),Y.initializingAccount=!1})):void console.error("Can't set account id to: "+e)},isReLoginRequired:function(e){return!!e&&!!e.responseJSON&&403===e.responseJSON.httpStatus&&1005===e.responseJSON.code},excludeCurrentAccount:function(){var e=Y.selectedAccountId,n=Y.accounts.indexOf(Y.selectedAccount);n>-1&&Y.accounts.splice(n,1),delete Y.accountMap[e],Y.accountIdsToExclude.push(e)},getInstrumentFromSymbol:function(e){return e?Y.getInstrumentForProperty(Y.availableInstruments,"symbol",e):null},getInstrumentFromId:function(e){return e&&Y.tradingEnabled?I(e)?Y.getInstrumentForProperty(Y.availableInstruments,"instrumentId",e):(console.warn("Instrument Id not found..."),null):null},getInstrumentFromBrokerageAccountSymbol:function(e){return Y.getInstrumentForProperty(Y.availableInstruments,"brokerageAccountSymbol",e)},getInstrumentForProperty:function(e,t,o){var r=null;return n(e).each(function(e,n){return n[t].toUpperCase()===o.toUpperCase()?(r=n,!1):void 0}),r},calculatePipDistance:function(e,n,t){var o=Y.getInstrumentFromId(e);if(!o)throw"Instrument not found for the given instrumentId: "+e;var r=o.pipPrecision?o.pipPrecision:0,c=(t-n)*Math.pow(10,r);return Math.round(10*c)/10},calculateExpectedProfitOrLoss:function(e,n,t){return Math.round(e*n*t*100)/100},calculatePositionSizeForRiskPercentage:function(e,n,t,o,r){return Y.calculatePositionSize(e,n,!1,t,o,r)},calculatePositionSizeForRiskAmount:function(e,n,t,o,r){return Y.calculatePositionSize(e,n,!0,t,o,r)},calculatePositionSize:function(e,n,t,o,r,c){var i=c;if(!i&&Y.lastSnapshot)i=Y.lastSnapshot.metrics.equity;else if(!c)throw"Please provide the equity or subscribe to account updates before calling calculatePositionSizeForAccount.";if(!t&&n>100)throw"Please provide a valid risk value: riskIsMoney is false but the provided risk is not a percentage..";var a=t?n:i*n/100,u=a/o/r,s=Y.getInstrumentFromId(e);if(s.multipleOfMinAmount)u=Math.floor(u/s.minAmount)*s.minAmount;else{var l=d(s.minAmount),f=Math.pow(10,l);u=Math.floor(u*f)/f}return u},getAccountById:function(e){return Y.accountMap[e]},getUser:function(e,n){return Y.makeOsRequest("user","GET","","",null,e,n)},getAppInfo:function(e,n){return Y.makeOsRequest("apps","GET","",Y.app_id,null,e,n)},getBrokers:function(e,n){return Y.makeOsRequest("brokers","GET","","",null,e,n)},authenticateWithCredentials:function(e,t,o,r,c,i){var a=new n.Deferred;"function"==typeof r&&("function"==typeof c&&(i=c),c=r);var u={appId:Y.app_id,brokerId:e,login:t,password:o};return"string"==typeof r&&(u.externalId=r),Y.makeAuthenticationRequest(a,"authenticate",u),M(a,c,i)},createDemoAccount:function(e,t,o){var r=new n.Deferred,c={appId:Y.app_id,type:e};return Y.makeAuthenticationRequest(r,"createDemoAccount",c),M(r,t,o)},makeAuthenticationRequest:function(e,n,t){var o;return Y.makeOsRequest(n,"POST","","",t).then(function(e){return o=e,Y.enableTrading(e.apiTokenValue,e.apiEndpoint,e.expires)}).then(function(){e.resolve(o)},function(n){e.reject(n)})},createForexDemoAccount:function(e,n){return Y.createDemoAccount("FOREX",e,n)},createStocksDemoAccount:function(e,n){return Y.createDemoAccount("STOCKS",e,n)},refreshAuthentication:function(e,t,o,r){var c=new n.Deferred,i={refreshTokenValue:e};return t&&(i={refreshTokenValue:e,appSecret:t}),Y.makeAuthenticationRequest(c,"refreshAuthentication",i),M(c,o,r)},getAccounts:function(e,t){var o=Y.makeAccountRequest("GET","","",null).then(function(e){Y.accounts.splice(0,Y.accounts.length),Y.allAccounts.splice(0,Y.allAccounts.length),Y.accountMap={},n(e.accounts).each(function(e,n){n.uniqueId&&"NA"!==n.uniqueId&&Y.accountIdsToExclude.indexOf(n.uniqueId)<=-1&&(Y.accounts.push(n),Y.accountMap[n.uniqueId]=n),Y.allAccounts.push(n)})});return M(o,e,t)},getCandles:function(e,n,t,o,r,c){return Y.getCandlesForAccount(Y.selectedAccountId,e,n,t,o,r,c)},getCandlesForAccount:function(e,n,t,o,r,c,i){var a={instrumentId:n,from:t,to:o,aggregation:r};return Y.makeAccountRequest("POST",e,"candles/",a,c,i)},subscribedCandleId:void 0,lastReceivedCandle:void 0,startCandleUpdates:function(e,t,o,r){function c(){Y.on("internalCandleUpdates","accountUpdated",function(t){var o=a(e,t.prices);if(Y.lastReceivedCandle&&o&&o.bid){var c=JSON.stringify(n.extend({},Y.lastReceivedCandle));if(i(o,u),c!==JSON.stringify(Y.lastReceivedCandle)){var s=[];return s.push(Y.lastReceivedCandle),r(s)}}})}function i(e,n){var t=e.bid;if(Date.now()-Y.lastReceivedCandle.timestamp>=n){Y.lastReceivedCandle.timestamp=Y.lastReceivedCandle.timestamp+n;var o=Y.lastReceivedCandle.close;Y.lastReceivedCandle.open=o,Y.lastReceivedCandle.high=o,Y.lastReceivedCandle.low=o}Y.lastReceivedCandle.close=t,t>Y.lastReceivedCandle.high&&(Y.lastReceivedCandle.high=t),t<Y.lastReceivedCandle.low&&(Y.lastReceivedCandle.low=t)}function a(e,t){var o=null;return n(t).each(function(n,t){return t.instrumentId===e?(o=t,!1):void 0}),o}Y.stopCandleUpdates();var u=60*o*1e3;Y.subscribedCandleId=e,Y.addInstrumentIdToUpdates("internalCandleUpdates",Y.subscribedCandleId),Y.getCandles(e,t,Date.now(),o).then(function(e){return Y.lastReceivedCandle=e.candles[e.candles.length-1],c(),r(e.candles)},function(e){C(e.responseJSON)})},stopCandleUpdates:function(){Y.subscribedCandleId&&(Y.removeInstrumentIdFromUpdates("internalCandleUpdates",Y.subscribedCandleId),Y.off("internalCandleUpdates"),Y.subscribedCandleId=void 0,Y.lastReceivedCandle=void 0)},getSnapshot:function(e,n,t){return Y.getSnapshotForAccount(Y.selectedAccountId,e,n,t)},getSnapshotForAccount:function(e,n,t,o){var r={instrumentIds:n,includeMarginFactors:!1};return Y.makeAccountRequest("POST",e,"",r,t,o)},getInstrumentsFromIds:function(e,n,t){return Y.getInstrumentsFromIdsForAccount(Y.selectedAccountId,e,n,t)},getInstrumentsFromIdsForAccount:function(e,t,o,r){var c=new n.Deferred,i=[];h(e)||(i=y(t));var a=new n.Deferred;if(i.length){var u={instrumentIds:i};Y.makeAccountRequest("POST",e,"instruments/",u).then(function(e){b(e.instruments),a.resolve(Y.availableInstruments)},function(e){c.reject(e)})}else Y.getOrResolveInstrumentsForAccountId(e,a,c);return a.then(function(e){var o=[];n(t).each(function(n,t){var r=Y.getInstrumentForProperty(e,"instrumentId",t);r&&o.push(r)}),c.resolve({instruments:o})},function(e){c.reject(e)}),M(c,o,r)},getOrResolveInstrumentsForAccountId:function(e,n,t){Y.selectedAccount&&e===Y.selectedAccount.uniqueId?n.resolve(Y.availableInstruments):p(e).then(function(e){n.resolve(e)},function(e){t.reject(e)})},searchInstruments:function(e,n,t){return Y.searchInstrumentsForAccount(Y.selectedAccountId,e,n,t)},searchInstrumentsForAccount:function(e,t,o,r){function c(e,t){var o=new RegExp(i(t),"i");return n.grep(e,function(e){return o.test(e.symbol)||o.test(e.brokerageAccountSymbol)||o.test(e.displayName)||o.test(e.type)})}function i(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function a(e){var t=n.extend({},e),o=["instrumentId","symbol","brokerageAccountSymbol","displayName","shortDescription","type"],r=[];for(var c in t)t.hasOwnProperty(c)&&n.inArray(c,o)<0&&r.push(c);return n(r).each(function(e,n){delete t[n]}),t}var u=new n.Deferred;if(h(e)){var s=new n.Deferred;Y.getOrResolveInstrumentsForAccountId(e,s,u),s.then(function(e){var o=c(e,t),r=[];n(o).each(function(e,n){r.push(a(n))}),u.resolve(r)},function(e){u.reject(e)})}else{var d={query:t};t.length<2?u.resolve([]):Y.makeAccountRequest("POST",e,"instrumentsearch/",d).then(function(e){u.resolve(e.instruments)},function(e){u.reject(e)})}return M(u,o,r)},getMetrics:function(e,n){return Y.getMetricsForAccount(Y.selectedAccountId,e,n)},getMetricsForAccount:function(e,n,t){return Y.makeAccountRequest("GET",e,"metrics/",null,n,t)},getOrders:function(e,n){return Y.getOrdersForAccount(Y.selectedAccountId,e,n)},getOrdersForAccount:function(e,n,t){return Y.makeAccountRequest("GET",e,"orders/",null,n,t)},placeMarketOrder:function(e,n,t,o,r){return Y.placeOrder(e,0,n,t,"MARKET",o,r)},placeMarketOrderForAccount:function(e,n,t,o,r,c){return Y.placeOrderForAccount(e,n,0,t,o,"MARKET",r,c)},placeLimitOrder:function(e,n,t,o,r,c){return Y.placeOrder(e,n,t,o,"LIMIT",r,c)},placeLimitOrderForAccount:function(e,n,t,o,r,c,i){return Y.placeOrderForAccount(e,n,t,o,r,"LIMIT",c,i)},placeStopOrder:function(e,n,t,o,r,c){return Y.placeOrder(e,n,t,o,"STOP",r,c)},placeStopOrderForAccount:function(e,n,t,o,r,c,i){return Y.placeOrderForAccount(e,n,t,o,r,"STOP",c,i)},placeOrder:function(e,n,t,o,r,c,i){return Y.placeOrderForAccount(Y.selectedAccountId,e,n,t,o,r,c,i)},placeOrderForAccount:function(e,n,t,o,r,c,i,a){var u={amount:n,price:t,side:o,instrumentId:r,type:c};return Y.makeAccountRequest("POST",e,"orders/",u,i,a)},placeOrderWithProtections:function(e,n,t,o,r,c,i,a,u){return Y.placeOrderWithProtectionsForAccount(Y.selectedAccountId,e,n,t,o,r,c,i,a,u)},placeOrderWithProtectionsForAccount:function(e,n,t,o,r,c,i,a,u,s){console.warn("placeOrderWithProtections is deprecated and will eventually be removed, please use placeProtectedOrder or placeProtectedOrderForAccount instead.");var d={amount:n,price:t,side:o,instrumentId:r,type:c};return i&&(d.takeProfitDistance=i),a&&(d.stopLossDistance=a),Y.makeAccountRequest("POST",e,"orders/",d,u,s)},placeProtectedOrder:function(e,n,t,o,r,c,i,a,u,s){return Y.placeProtectedOrderForAccount(Y.selectedAccount.uniqueId,e,n,t,o,r,c,i,a,u,s)},placeProtectedOrderForAccount:function(e,t,o,r,c,i,a,u,s,d,l){Y.validateOrderParams(i,o,s,a,u);var f={amount:t,price:o,side:r,instrumentId:c,type:i},p="MARKET"===i?s:o;return n.extend(f,Y.getOrderProtections(e,a,u,p)),Y.makeAccountRequest("POST",e,"orders/",f,d,l)},validateOrderParams:function(e,n,t,o,r){if("MARKET"===e){if(!(!o&&!r||"number"==typeof t&&t))throw"MARKET orders require a valid 'currentBidOrAskPrice'";if(0!==n)throw"The price for MARKET orders must be 0"}else if("MARKET"!==e&&("number"!=typeof n||!n))throw"LIMIT and STOP orders require a valid order price"},modifyProtectedOrder:function(e,n,t,o,r,c,i){return Y.modifyProtectedOrderForAccount(Y.selectedAccount.uniqueId,e,n,t,o,r,c,i)},modifyProtectedOrderForAccount:function(e,t,o,r,c,i,a,u){var s=o&&o!==t.price?o:t.price,d=t.price!==s?{price:s}:{},l="MARKET"===t.type?i:s,f=Y.getOrderProtections(e,r,c,l);return Y.verifyProtectionModification(t,f,"takeProfit"),Y.verifyProtectionModification(t,f,"stopLoss"),n.extend(d,f),Y.makeAccountRequest("PUT",e,"orders/"+t.id,d,a,u)},verifyProtectionModification:function(e,n,t){(n[t]===e[t]||e[t]&&n[t]&&n[t].value===e[t].value&&n[t].entryType===e[t].entryType)&&delete n[t]},getOrderProtections:function(e,t,o,r){function c(e,n,t){return null===e?e:{entryType:t,value:"DISTANCE"===t?Math.abs(n-e):e}}var i=Y.accountMap[e],a=i.protectionEntryTypes.entryTypes,u={};if(a.length){var s=-1!==n.inArray("ABSOLUTE",a)?"ABSOLUTE":"DISTANCE";"undefined"!=typeof t&&(u.takeProfit=c(t,r,s)),"undefined"!=typeof o&&(u.stopLoss=c(o,r,s))}return u},cancelTakeProfitOnOrder:function(e,n,t){return Y.cancelTakeProfitOnOrderForAccount(Y.selectedAccount.uniqueId,e,n,t)},cancelTakeProfitOnOrderForAccount:function(e,n,t,o){return Y.makeAccountRequest("PUT",e,"orders/"+n,{takeProfit:null},t,o)},cancelStopLossOnOrder:function(e,n,t){return Y.cancelStopLossOnOrderForAccount(Y.selectedAccount.uniqueId,e,n,t)},cancelStopLossOnOrderForAccount:function(e,n,t,o){return Y.makeAccountRequest("PUT",e,"orders/"+n,{stopLoss:null},t,o)},getPendingOrders:function(e,n){return Y.getPendingOrdersForAccount(Y.selectedAccountId,e,n)},getPendingOrdersForAccount:function(e,n,t){return Y.makeAccountRequest("GET",e,"orders/pending",null,n,t)},getOrderById:function(e,n,t){return Y.getOrderByIdForAccount(Y.selectedAccountId,e,n,t)},getOrderByIdForAccount:function(e,n,t,o){return Y.makeAccountRequest("GET",e,"orders/"+n,null,t,o)},modifyOrderPrice:function(e,n,t,o){return Y.modifyOrderPriceForAccount(Y.selectedAccountId,e,n,t,o)},modifyOrderPriceForAccount:function(e,n,t,o,r){return Y.makeAccountRequest("PUT",e,"orders/"+n,{price:t},o,r)},cancelOrder:function(e,n,t){return Y.cancelOrderForAccount(Y.selectedAccountId,e,n,t)},cancelOrderForAccount:function(e,n,t,o){return Y.makeAccountRequest("DELETE",e,"orders/"+n,null,t,o)},getPositions:function(e,n){return Y.getPositionsForAccount(Y.selectedAccountId,e,n)},getPositionsForAccount:function(e,n,t){return Y.makeAccountRequest("GET",e,"positions/",null,n,t)},closeAllPositions:function(e,n){return Y.closeAllPositionsForAccount(Y.selectedAccountId,e,n)},closeAllPositionsForAccount:function(e,n,t){return Y.makeAccountRequest("DELETE",e,"positions/",null,n,t)},getOpenPositions:function(e,n){return Y.getOpenPositionsForAccount(Y.selectedAccountId,e,n)},getOpenPositionsForAccount:function(e,n,t){return Y.makeAccountRequest("GET",e,"positions/open",null,n,t)},getPositionById:function(e,n,t){return Y.getPositionByIdForAccount(Y.selectedAccountId,e,n,t)},getPositionByIdForAccount:function(e,n,t,o){return Y.makeAccountRequest("GET",e,"positions/"+n,null,t,o)},reducePositionToAmount:function(e,n,t,o){return Y.reducePositionToAmountForAccount(Y.selectedAccountId,e,n,t,o)},reducePositionToAmountForAccount:function(e,n,t,o,r){var c={amount:t};return Y.makeAccountRequest("PUT",e,"positions/"+n,c,o,r)},closePosition:function(e,n,t){return Y.closePositionForAccount(Y.selectedAccountId,e,n,t)},closePositionForAccount:function(e,n,t,o){return Y.makeAccountRequest("DELETE",e,"positions/"+n,null,t,o)},addOrModifyProtections:function(e,n,t,o,r){return Y.addOrModifyProtectionsForAccount(Y.selectedAccountId,e,n,t,o,r)},addOrModifyProtectionsForAccount:function(e,n,t,o,r,c){var i={};return null!==t&&(i.takeprofit=t),null!==o&&(i.stoploss=o),Y.makeAccountRequest("PUT",e,"positions/"+n+"/protections/",i,r,c)},cancelProtections:function(e,n,t){return Y.cancelProtectionsForAccount(Y.selectedAccountId,e,n,t)},cancelProtectionsForAccount:function(e,n,t,o){return Y.makeAccountRequest("DELETE",e,"positions/"+n+"/protections/",null,t,o)},addOrModifyTakeProfit:function(e,n,t,o){return Y.makeProtectionRequest("PUT",e,n,"TAKEPROFIT",t,o)},addOrModifyTakeProfitForAccount:function(e,n,t,o,r){return Y.makeProtectionRequestForAccount("PUT",e,n,t,"TAKEPROFIT",o,r)},addOrModifyStopLoss:function(e,n,t,o){return Y.makeProtectionRequest("PUT",e,n,"STOPLOSS",t,o)},addOrModifyStopLossForAccount:function(e,n,t,o,r){return Y.makeProtectionRequestForAccount("PUT",e,n,t,"STOPLOSS",o,r)},cancelTakeProfit:function(e,n,t){return Y.makeProtectionRequest("DELETE",e,0,"TAKEPROFIT",n,t)},cancelTakeProfitForAccount:function(e,n,t,o){return Y.makeProtectionRequestForAccount("DELETE",e,n,0,"TAKEPROFIT",t,o)},cancelStopLoss:function(e,n,t){return Y.makeProtectionRequest("DELETE",e,0,"STOPLOSS",n,t)},cancelStopLossForAccount:function(e,n,t,o){return Y.makeProtectionRequestForAccount("DELETE",e,n,0,"STOPLOSS",t,o)},makeProtectionRequest:function(e,n,t,o,r,c){return Y.makeProtectionRequestForAccount(e,Y.selectedAccountId,n,t,o,r,c)},makeProtectionRequestForAccount:function(e,n,t,o,r,c,i){var a={price:o};return"DELETE"===e&&(a=null),Y.makeAccountRequest(e,n,"positions/"+t+"/protections/"+r,a,c,i)},getPrices:function(e,n,t){return Y.getPricesForAccount(Y.selectedAccountId,e,n,t)},getPricesForAccount:function(e,t,o,r){var c={instrumentIds:t};if(h(e)||e!==Y.selectedAccount.uniqueId)return Y.makeAccountRequest("POST",e,"prices/",c,o,r);var i,a=new n.Deferred,u=y(t);return i=u.length?Y.getInstrumentsFromIdsForAccount(e,u).then(function(){return Y.makeAccountRequest("POST",e,"prices/",c)}):Y.makeAccountRequest("POST",e,"prices/",c),i.then(function(e){a.resolve(e)},function(e){a.reject(e)}),M(a,o,r)},makeCandleRequest:function(e,t,o,r,c){var i={instrumentIds:t};"getQuotes"===e&&(i={symbols:t}),c&&(i=c);var a=n.ajax({type:"POST",crossDomain:!0,url:"https://candles-api.tradable.com/"+e,contentType:"application/json; charset=utf-8",data:JSON.stringify(i),dataType:"json"});if(o||r)return a.then(function(e){return"function"==typeof o?o(e.dailyClose?e.dailyClose:e):void 0},function(e,n,t){return"function"==typeof r?r(e,n,t):void 0});var u=new n.Deferred;return a.then(function(e){return e.dailyClose?u.resolve(e.dailyClose):u.resolve(e)},function(e,n,t){return u.reject(e,n,t)}),"undefined"!=typeof Promise&&-1!==Promise.toString().indexOf("[native code]")?Promise.resolve(u.promise()):u.promise()},getLastDailyClose:function(e,n,t){return Y.makeCandleRequest("dailyClose",e,n,t)},initializeWithToken:function(e,n,t,o,r){e&&n&&(Y.accessToken=e,Y.authEndpoint=n,u()&&(localStorage.setItem("accessToken:"+_,Y.accessToken),localStorage.setItem("authEndpoint:"+_,Y.authEndpoint),t&&(Y.expirationTimeUTC=(new Date).getTime()+1e3*parseInt(t,10),
localStorage.setItem("expirationTimeUTC:"+_,Y.expirationTimeUTC))));var c=Y.getAccounts();return M(c,o,r)},reLogin:function(e,n){return Y.reLoginForAccount(Y.selectedAccount.uniqueId,e,n)},reLoginForAccount:function(e,n,t){var o={},r=Y.makeAccountRequest("POST",e,"reLogin/",o).then(function(){E(!0)});return M(r,n,t)},enableTrading:function(e,t,o,r){var c=new n.Deferred;console.log("Enabling Trading..."),Y.tradingEnabled=!1,Y.lastSnapshot=void 0;var i=Y.accounts.length;return Y.initializeWithToken(e,t,o).then(function(){return k(r,i)}).then(function(){c.resolve()},function(e){c.reject(e)}),c}};t();var $=[],Z={},ee=!1;e.trEmbJQ=trEmbJQ,e.tradable=Y,e.tradableEmbed=Y,"function"==typeof define&&define&&define.amd?define("tradable-core",[],Y):"function"==typeof require&&"object"==typeof module&&module&&module.exports&&(module.exports=Y)}(jsGlobalObject,trEmbJQ);