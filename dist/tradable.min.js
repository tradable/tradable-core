/******  Copyright 2017 Tradable ApS; @license MIT; v1.24  ******/
function isGreaterOrEqualMinVersion(e,n){return this.toNum=function(e){return parseInt(e,10)},this.highest=function(e,n){for(var t=e.split(".").map(this.toNum),o=n.split(".").map(this.toNum),r=0;r<t.length;r++)if(t[r]!==o[r])return t[r]>o[r]?e:n;if(o.length>t.length)return n},!("undefined"!=typeof highest(e,n)&&highest(e,n)===n)}"undefined"!=typeof console&&"function"==typeof console.log&&"function"==typeof console.warn&&"function"==typeof console.error||(console={log:function(){},warn:function(){},error:function(){}}),"undefined"==typeof jQuery?console.warn("tradable requires jQuery to run"):isGreaterOrEqualMinVersion(jQuery.fn.jquery,"2.1.4")||console.warn("tradable requires jQuery version 2.1.4 or above");var trEmbJQ=jQuery.noConflict(!0),jsGlobalObject="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:this;!function(e,n){"use strict";function t(){function e(e,n){n.tradingEnabled=!1,f()&&s("tradingEnabled:"+ie,!1);var t=o(e);return!(!t.accessToken||!t.endPoint)&&(n.enableTrading(t.accessToken,t.endPoint,t.expiresIn),"osLaunch"===window.name&&window.close(),!0)}var t=!1,r=window.opener;if(r&&"osBrokerSignUp"===window.name)window.close();else if(r&&"osLaunch"===window.name){var i=window.location.hash;if(i){try{r.postMessage("replace your location","*"),t=e(i,r.tradable)}catch(c){t=!1}t||(t=e(i,ve))}}else window.location.hash&&window.location.hash.indexOf("access_token")!==-1&&window.location.hash.indexOf("endpointURL")!==-1&&window.location.hash.indexOf("expires_in")!==-1?t=e(window.location.hash,ve):ve.tradingEnabled&&(F(),t=!0);t||(ve.log("Initiating without authentication..."),n(document).ready(function(){q()}))}function o(e){var t={accessToken:void 0,endPoint:void 0,expiresIn:void 0},o=e.replace("#","").split("&");return n(o).each(function(e,n){var o=n.split("="),r=o[0],i=o[1];"access_token"===r?t.accessToken=i:"endpointURL"===r?t.endPoint=i:"expires_in"===r&&(t.expiresIn=i)}),t}function r(){var t="undefined"!=typeof e.tradableEmbedConfig?e.tradableEmbedConfig:e.tradableConfig;if("undefined"==typeof t){var o=0!==n("#tradable-embed").length?"#tradable-embed":0!==n("#tradable").length?"#tradable":"#tradable-api";t={appId:n(o).attr("data-app-id"),appKey:n(o).attr("data-app-key"),configId:n(o).attr("data-config-id"),redirectURI:n(o).attr("data-redirect-uri"),customOAuthURL:n(o).attr("data-custom-oauth-url"),customOAuthHost:n(o).attr("data-custom-oauth-host")}}return t}function i(){var e=tradableConfig.redirectURI?tradableConfig.redirectURI:location.href;return encodeURIComponent(e)}function c(e){var n={},t=tradableConfig.customOAuthURL,o=tradableConfig.customOAuthHost,r="api.tradable.com/";ie>2e5&&(r="api-staging.tradable.com/"),o&&(r=o);var i="https://"+r+"oauth/authorize?client_id="+ie+"&scope=trade&response_type=token&redirect_uri="+e,c=t?t:i;return n.oauthHost=r,n.oauthURL=c,n}function u(){var e={};return e.token=d("accessToken:"+ie),e.authEndpoint=d("authEndpoint:"+ie),e.tradingEnabled=d("tradingEnabled:"+ie),e.expirationTimeUTC=d("expirationTimeUTC:"+ie),!e.tradingEnabled||e.authEndpoint&&e.token&&e.expirationTimeUTC||(e.tradingEnabled=!1,f()&&s("tradingEnabled:"+ie,e.tradingEnabled)),e}function a(n){return"undefined"!=typeof e.tradableConfig.configId?e.tradableConfig.configId+n:n}function s(e,n){localStorage.setItem(a(e),n)}function d(e){return localStorage.getItem(a(e))}function l(e){localStorage.removeItem(a(e))}function f(){var e="test";try{return s(e,"1"),l(e),!0}catch(n){return!1}}function p(e,n){var t=window.screenLeft?window.screenLeft:window.screenX,o=window.screenTop?window.screenTop:window.screenY,r=420,i=500,c=t+window.innerWidth/2-r/2,u=o+window.innerHeight/2-i/2;return window.open(e,n,"toolbar=no, titlebar=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+r+", height="+i+", top="+u+", left="+c)}function h(e){if("number"!=typeof e)return 0;var n=String(e).replace(",",".").split(".")[1];return n?n.length:0}function A(e,t){var o=!1;ve.tradingEnabled&&(ve.tradingEnabled=!1,o=!0),b();var r=new n.Deferred;return I().then(function(){ve.log("Instruments ready"),o&&(ve.tradingEnabled=!0,B()),r.resolve(ve.accounts)},function(e){r.reject(e)}),Z(r,e,t)}function g(e,n){return m(ve.selectedAccountId,e,n)}function m(e,n,t){return ve.makeAccountRequest("GET",e,"instruments/",null,n,t)}function v(){return"FULL_INSTRUMENT_LIST"===ve.selectedAccount.instrumentRetrieval}function T(e){var t=!0;return n(ve.accounts).each(function(n,o){o.uniqueId===e&&"FULL_INSTRUMENT_LIST"!==o.instrumentRetrieval&&(t=!1)}),t}function I(){var e=new n.Deferred;return v()?g().then(function(n){E(n),e.resolve(ve.availableInstruments)},function(n){e.reject(n)}):(Te=[],ve.searchInstruments("EUR").then(function(e){return y(e),ve.searchInstruments("AUD")}).then(function(e){return y(e),ve.searchInstruments("USD")}).then(function(e){return y(e),ve.getPrices(Te)}).then(function(){e.resolve(ve.availableInstruments)},function(n){e.reject(n)})),e}function y(e){var t=0;n(e).each(function(e,n){6!==n.symbol.length&&7!==n.symbol.length||!(t<11||"EURUSD"===n.symbol)||(Te.push(n.instrumentId),t++)})}function b(){ve.availableCategories.splice(0,ve.availableCategories.length),ve.availableInstruments.splice(0,ve.availableInstruments.length),ve.availableSymbols.splice(0,ve.availableSymbols.length),ve.availableCurrencies.splice(0,ve.availableCurrencies.length),ve.instrumentKeysForAccountUpdates.splice(0,ve.instrumentKeysForAccountUpdates.length),Ie={}}function O(e){return"undefined"!=typeof Ie[e]}function E(e){function t(e){var t=["100","200","225","spx","h33","nas","u30","e50","f40","d30","e35","i40","z30","s30","uso","uko"];n.inArray(e,ve.availableCurrencies)===-1&&n.inArray(e,t)===-1&&ve.availableCurrencies.push(e)}n(e).each(function(e,o){if(!O(o.instrumentId)){ve.availableInstruments.push(o),ve.availableSymbols.push(o.symbol);var r=o.symbol.replace("/","");if(("FOREX"===o.type||"CFD"===o.type)&&6===r.length){var i=r.toLowerCase().substring(0,3),c=r.toLowerCase().substring(3,6);t(i),t(c)}n.inArray(o.type,ve.availableCategories)===-1&&ve.availableCategories.push(o.type),Ie[o.instrumentId]=!0}})}function w(e){var t=[];return n(e).each(function(e,n){O(n)||t.push(n)}),t}function P(){ve.instrumentKeysForAccountUpdates.length&&ve.instrumentKeysForAccountUpdates.splice(0,ve.instrumentKeysForAccountUpdates.length)}function R(){ve.accountIdsToExclude.splice(0,ve.accountIdsToExclude.length)}function k(e,n){var t=ve.accounts.length;ve.excludeCurrentAccount(),ve.log("Account initialization failed.."),ve.accounts.length>0?(ve.log("Resetting to previous account"),U(!1,t).then(function(){ve.initializingAccount=!1},function(){ve.initializingAccount=!1})):(ve.log("No more accounts available, signing out.."),ve.signOut(),ve.initializingAccount=!1),e.reject(n)}function F(){ve.log("Validating token..."),ve.getAccounts().then(function(){ve.enableTrading(ve.accessToken,ve.authEndpoint)},function(){C(!1)})}function S(e,n){var t,o=d("selectedAccount:"+ie),r=ve.accounts.length-1;return e&&ve.accounts.length>n?t=ve.accounts[r].uniqueId:o&&ve.accountMap[o]?t=o:r>=0&&(t=ve.accounts[r].uniqueId),t}function U(e,t){var o=new n.Deferred,r=S(e,t);return P(),r?ve.setSelectedAccount(r,function(){C(!0),o.resolve()},function(e){o.reject(e)}):(ve.signOut(),o.reject()),o}function C(e){e!==ve.tradingEnabled&&(ve.tradingEnabled=e,ve.log("Embed ready: "+ve.tradingEnabled),f()&&s("tradingEnabled:"+ie,ve.tradingEnabled),q())}function q(){n(ve.readyCallbacks).each(function(e,n){z(n)}),G("embedReady"),ve.notifiedCallbacks=!0}function x(){if(ve.tradingEnabled&&!ve.initializingAccount&&!ye&&(pe.length>0||void 0!==typeof le.accountUpdated)){var e=ve.selectedAccountId;ye=!0;var t=[];n(ve.instrumentKeysForAccountUpdates).each(function(e,o){var r=o.substring(0,o.indexOf(":"));n.inArray(r,t)===-1&&t.push(r)}),ve.getSnapshot(t).then(function(t){return e===ve.selectedAccountId?(ve.lastSnapshot=t,L(t)):(new n.Deferred).reject()}).then(function(e){ve.tradingEnabled&&!ve.initializingAccount&&(n.each(pe,function(n,t){z(t,e)}),G("accountUpdated",e)),ye=!1},function(){ye=!1})}}function L(e){var t=new n.Deferred;if(v())t.resolve(e);else{var o=[],r=function(e,n){O(n.instrumentId)||o.push(n.instrumentId)};n(e.positions.open).each(r),n(e.orders.pending).each(r),o.length?ve.getInstrumentsFromIds(o).then(function(){t.resolve(e)},function(e){t.reject(e)}):t.resolve(e)}return t}function _(e){var n=!1;if(ve.processingTwoFactorAuthentication||(n=!0,ve.processingTwoFactorAuthentication=!0,ve.currentTwoFactorChallenge=e,ve.log("Two factor authentication challenge received"),G("twoFactorAuthentication",{status:ve.TWO_FACTOR_AUTH_STATUS.RECEIVED,instruction:e.instruction,requiresUserInput:e.requiresUserInput}),ve.tradingEnabled&&C(!1)),e.requiresUserInput||M(e),n)return D()}function M(e){return ve.makeOsRequest(ve.TWO_FACTOR_AUTH,"POST","","",e).then(function(e){ve.currentTwoFactorChallenge=null,ve.processingTwoFactorAuthentication=!1,ve.log("Two factor authentication challenge passed"),G("twoFactorAuthentication",{status:ve.TWO_FACTOR_AUTH_STATUS.PASSED}),e.apiTokenValue?ve.enableTrading(e.apiTokenValue,e.apiEndpoint,e.expires):ve.enableTrading(ve.accessToken,ve.authEndpoint)},function(n){e.requiresUserInput&&(ve.currentTwoFactorChallenge=null,N(n))})}function D(){var e=new n.Deferred,t=Ee;return ve.on("internal2fTradAuthListener"+t,"twoFactorAuthentication",function(n){n.status===ve.TWO_FACTOR_AUTH_STATUS.PASSED?(ve.off("internal2fTradAuthListener"+t,"twoFactorAuthentication"),e.resolve()):n.status===ve.TWO_FACTOR_AUTH_STATUS.FAILED&&(ve.off("internal2fTradAuthListener"+t,"twoFactorAuthentication"),e.reject(n.error))}),Ee+=1,e}function N(e){ve.processingTwoFactorAuthentication=!1,ve.warn("Two factor authentication challenge failed"),G("twoFactorAuthentication",{status:ve.TWO_FACTOR_AUTH_STATUS.FAILED,error:e.responseJSON})}function j(){ve.log("Token expired"),C(!1),n(Ae).each(function(e,n){z(n)}),G("tokenExpired")}function K(e){n(me).each(function(n,t){z(t,e)}),G("error",e)}function B(){ve.log("Account switched: "+ve.selectedAccount.displayName),n(fe).each(function(e,n){z(n)}),G("accountSwitch")}function W(){C(!1),G("reLoginRequired")}function G(e,n){if(ve.isEventValid(e)){if(void 0!==typeof le[e])for(var t in le[e])le[e].hasOwnProperty(t)&&z(le[e][t],n)}else ve.error("Careful, can't notify '"+e+"', it's an invalid event name")}function z(e,n){try{if(n)return e(n);e()}catch(t){ve.error(t)}}function H(e){ve.selectedAccount.uniqueId!==be&&(V(),be=ve.selectedAccount.uniqueId),Oe||(Oe=new J,Oe.orders=Q(e.orders.pending,"orders",!0),Oe.cancelledOrders=Q(e.orders.recentlyCancelled,"cancelledOrders",!0),Oe.positions=Q(e.positions.open,"positions",!0),Oe.closedPositions=Q(e.positions.recentlyClosed,"closedPositions",!0));var n=new J(Q(e.orders.pending,"orders"),Q(e.orders.recentlyCancelled,"cancelledOrders"),Q(e.positions.open,"positions"),Q(e.positions.recentlyClosed,"closedPositions"));return n.getTotal()>0&&G("execution",n),n}function V(){Oe=void 0}function J(e,n,t,o){this.orders=e?e:[],this.cancelledOrders=n?n:[],this.positions=t?t:[],this.closedPositions=o?o:[],this.getTotal=function(){return this.orders.length+this.cancelledOrders.length+this.positions.length+this.closedPositions.length}}function Q(e,t,o){for(var r=[],i=0;i<e.length;i++){var c=e[i],u=$(c);Y(t,c.id,u)&&(Oe.positions=X(c.id,Oe.positions)),(!c.type||"MARKET"!==c.type)&&n.inArray(u,Oe[t])<0&&(r.push(o?u:c),Oe[t].push(u))}return r}function Y(e,t,o){var r=!1;return("positions"===e||"closedPositions"===e)&&n.inArray(o,Oe[e])<0&&n(Oe.positions).each(function(e,n){n.indexOf(t)>-1&&(r=!0)}),r}function X(e,t){return n.grep(t,function(n){return n.indexOf(e)<0})}function $(e){return e.id+(e.type?"":0!==e.amount?e.side+e.amount:e.lastModified)}function Z(e,n,t){return n||t?e.then(function(e){if("function"==typeof n)return n(e)},function(e,n,o){if("function"==typeof t)return t(e,n,o)}):e.promise()}function ee(){var e=new n.Deferred;if(ve.selectedAccount.brokerId<0&&1===ve.allAccounts.length)return e.resolve(),e;var t={tokenValue:ve.accessToken};return ve.makeOsRequest("internal","POST","","signOut",t).then(function(){e.resolve()},function(){e.reject()}),e}function ne(e,t,o,r){var i={httpStatus:400,code:e,message:t,debug:o};return r&&n.extend(i,{details:r}),{readyState:4,status:i.httpStatus,statusText:"Bad Request",responseJSON:i,responseText:JSON.stringify(i)}}function te(e){var n,t,o=0;if(0===e.length)return o;for(n=0;n<e.length;n++)t=e.charCodeAt(n),o=(o<<5)-o+t,o&=o;return o}function oe(){return navigator.userAgent.indexOf("MSIE")!==-1||/rv:11.0/i.test(navigator.userAgent)}function re(e){for(var n in e)if(e.hasOwnProperty(n))return!1;return!0}e.tradableConfig=r();var ie=tradableConfig.appId,ce=tradableConfig.appKey,ue=i(),ae=c(ue),se=u(),de=["embedStarting","embedReady","accountUpdated","accountSwitch","twoFactorAuthentication","tokenExpired","tokenWillExpire","reLoginRequired","execution","error"],le={},fe=[],pe=[],he=[],Ae=[],ge=[],me=[],ve={version:"1.24",app_id:ie,app_key:ce,oauth_host:ae.oauthHost,auth_loc:ae.oauthURL,external_id:void 0,login_loc:ae.oauthURL+"&showLogin=true",approval_page_loc:ae.oauthURL+"&showApproval=true",broker_signup_loc:"https://"+ae.oauthHost+"brokerSignup?client_id="+ie+"&redirect_uri="+ue,auth_window:null,authEndpoint:se.authEndpoint,accessToken:se.token,tradingEnabled:se.tradingEnabled,expirationTimeUTC:se.expirationTimeUTC,notifiedCallbacks:!1,readyCallbacks:[],allAccounts:[],accounts:[],accountIdsToExclude:[],accountMap:{},selectedAccount:null,selectedAccountId:null,availableCategories:[],availableInstruments:[],availableSymbols:[],availableCurrencies:[],lastSnapshot:null,instrumentKeysForAccountUpdates:[],accountUpdateMillis:700,showApprovalPage:function(){ve.openOAuthPage("APPROVAL",!0)},showApprovalPageInWindow:function(){ve.openOAuthPage("APPROVAL",!1)},authenticate:function(e){ve.tradingEnabled?F():ve.openOAuthPage("AUTHENTICATE",!0,e)},authenticateWithWindow:function(e){ve.openOAuthPage("AUTHENTICATE",!1,e)},showLoginPage:function(e){ve.openOAuthPage("LOGIN",!0,e)},showLoginPageInWindow:function(e){ve.openOAuthPage("LOGIN",!1,e)},showBrokerSignUpPage:function(){ve.openOAuthPage("BROKER_SIGNUP",!0)},showBrokerSignUpPageInWindow:function(){ve.openOAuthPage("BROKER_SIGNUP",!1)},setExternalId:function(e){ve.external_id=e},getOAuthUrl:function(e,n){var t="AUTHENTICATE"===e.toUpperCase()?ve.auth_loc:"LOGIN"===e.toUpperCase()?ve.login_loc:"APPROVAL"===e.toUpperCase()?ve.approval_page_loc:"BROKER_SIGNUP"===e.toUpperCase()?ve.broker_signup_loc:void 0;if(!t)throw"Choose a correct type: AUTHENTICATE, LOGIN, APPROVAL or BROKER_SIGNUP";return"undefined"!=typeof n&&(t=t+"&broker_id="+n),"AUTHENTICATE"!==e.toUpperCase()&&"LOGIN"!==e.toUpperCase()||"undefined"!=typeof ve.external_id&&(t=t+"&external_id="+ve.external_id),t},openOAuthPage:function(e,n,t){var o=ve.getOAuthUrl(e,t);if("AUTHENTICATE"!==e.toUpperCase()&&"LOGIN"!==e.toUpperCase()||R(),"undefined"!=typeof n&&n||oe())location.href=o;else{var r="BROKER_SIGNUP"===e.toUpperCase()?"osBrokerSignUp":"osLaunch";ve.auth_window=p(o,r)}},log:function(e){console.log("[TR] "+e)},warn:function(e){console.warn("[TR] "+e)},error:function(e){console.error("[TR] "+e)},enableWithAccessToken:function(e,n,t){return ve.enableTrading(e,n,t,!0)},signOut:function(){ee(),f()&&(l("accessToken:"+ie),l("authEndpoint:"+ie),l("tradingEnabled:"+ie),l("expirationTimeUTC:"+ie)),C(!1)},isEventValid:function(e){return"string"==typeof e&&n.inArray(e,de)!==-1},on:function(e,n,t){if(!ve.isEventValid(n))throw"Please provide a valid eventName: "+de;if(le[n]||(le[n]={}),"string"!=typeof e)throw"The given event namespace is invalid (needs to be a string)";if("undefined"!=typeof le[n][e])throw"The given event namespace is already taken, 'off' the event first to change it";if("function"!=typeof t)throw"Please provide a valid callback function";switch(n){case"embedReady":ve.initEmbedReady(t);break;case"accountUpdated":ve.initAccountUpdates();break;case"tokenWillExpire":ve.initTokenWillExpire();break;case"execution":ve.initExecutions()}le[n][e]=t},off:function(e,n){if("undefined"==typeof n)for(var t in le)le.hasOwnProperty(t)&&e in le[t]&&le[t].hasOwnProperty(e)&&delete le[t][e];else ve.isEventValid(n)&&le[n]&&e in le[n]&&delete le[n][e];for(n in le)if(le.hasOwnProperty(n)&&re(le[n]))switch(delete le[n],n){case"accountUpdated":ve.stopAccountUpdates();break;case"execution":ve.stopExecutions()}},initEmbedReady:function(e){if(ve.notifiedCallbacks)return z(e)},onEmbedReady:function(e){if(!e||"function"!=typeof e)throw"The specified callback is not a function";ve.readyCallbacks.push(e),ve.initEmbedReady(e)},accountUpdateInterval:null,initAccountUpdates:function(){null===ve.accountUpdateInterval&&(ve.accountUpdateInterval=setInterval(x,ve.accountUpdateMillis))},stopAccountUpdates:function(){pe.length||(clearInterval(ve.accountUpdateInterval),ve.accountUpdateInterval=null)},onAccountUpdated:function(e){if(!e||"function"!=typeof e)throw"The specified callback is not a function";ve.initAccountUpdates();var t=te(e.toString());n.inArray(t,he)===-1&&(pe.push(e),he.push(t))},setAccountUpdateFrequencyMillis:function(e){if(!(e&&e>0&&"number"==typeof e))throw"Please specify a valid update frequency";ve.accountUpdateMillis=e,ve.accountUpdateInterval&&(clearInterval(ve.accountUpdateInterval),ve.accountUpdateInterval=setInterval(x,ve.accountUpdateMillis))},addSymbolToUpdates:function(e,n){ve.warn("'addSymbolToUpdates' is now deprecated, 'addInstrumentIdToUpdates' should now be used instead."),ve.addInstrumentIdToUpdates(e,n)},removeSymbolFromUpdates:function(e,n){ve.warn("'removeSymbolFromUpdates' is now deprecated, 'removeInstrumentIdFromUpdates' should now be used instead."),ve.removeInstrumentIdFromUpdates(e,n)},addInstrumentIdToUpdates:function(e,t){if(e.indexOf(":")!==-1)throw"It is not allowed to include a colon ':' in the updateClientId";var o=t+":"+e;n.inArray(o,ve.instrumentKeysForAccountUpdates)===-1&&ve.instrumentKeysForAccountUpdates.push(o)},removeInstrumentIdFromUpdates:function(e,t){var o=t+":"+e;ve.instrumentKeysForAccountUpdates=n.grep(ve.instrumentKeysForAccountUpdates,function(e){return e!==o})},onAccountSwitch:function(e){ve.saveCallback(e,fe)},onTokenExpired:function(e){ve.saveCallback(e,Ae)},onError:function(e){ve.saveCallback(e,me)},saveCallback:function(e,t){e&&n.inArray(e,t)===-1&&t.push(e)},tokenWillExpireInterval:null,initTokenWillExpire:function(){function e(){var e=ve.getRemainingTokenMillis();e&&e>0&&e<18e5&&(n(ge).each(function(n,t){t(e)}),G("tokenWillExpire",e))}null===ve.tokenWillExpireInterval&&(ve.tokenWillExpireInterval=setInterval(e,3e5))},onTokenWillExpire:function(e){ve.initTokenWillExpire(),n.inArray(e,ge)===-1&&ge.push(e)},getRemainingTokenMillis:function(){return ve.expirationTimeUTC||ve.log("You need to authenticate before calling this method"),ve.expirationTimeUTC-(new Date).getTime()},listeningToExecutions:!1,initExecutions:function(){ve.listeningToExecutions||(ve.on("internalExecutionsListener","accountUpdated",H),ve.listeningToExecutions=!0)},stopExecutions:function(){ve.off("internalExecutionsListener","accountUpdated"),ve.listeningToExecutions=!1},makeOsRequest:function(e,t,o,r,i,c,u){var a,s="internal"===e?"":"v1/";if(e===ve.TWO_FACTOR_AUTH){a=i.endpointURL;var d={twoFactorAuthenticationToken:i.twoFactorAuthenticationToken};i.userInput&&(d=n.extend(d,{userInput:i.userInput})),i=d}else if("user"!==e&&"accounts"!==e)a="https://"+ve.oauth_host;else if(void 0!==o&&null!==o&&0===o.length)a=ve.authEndpoint;else{if(!ve.accountMap[o]){ve.warn("Please specify a valid accountId or method");var l=(new n.Deferred).reject("Invalid request: Please specify a valid accountId or method");return Z(l,c,u)}a=ve.accountMap[o].endpointURL}var f=n.ajax({type:t,beforeSend:function(n){"internal"!==e&&n.setRequestHeader("Authorization","Bearer "+ve.accessToken),n.setRequestHeader("x-tr-embed-sdk","js-"+ve.version)},crossDomain:!0,xhrFields:{withCredentials:!0},url:e===ve.TWO_FACTOR_AUTH?a:o&&o.length>0?a+s+e+"/"+o+"/"+r:a+s+e+"/"+r,contentType:"application/json; charset=utf-8",data:i?JSON.stringify(i):void 0,dataType:"json"});return f.then(function(){},function(e){e.responseJSON&&(ve.initializingAccount||403!==e.responseJSON.httpStatus&&502!==e.responseJSON.httpStatus||(ve.isTwoFactorAuthenticationRequired(e)?_(e.responseJSON):ve.isReLoginRequired(e)?W():ve.isTokenExpiredCode(e)?j():ve.isReLoginRequired(e)||C(!1)),ve.isReLoginRequired(e)||ve.isTwoFactorAuthenticationRequired(e)||(K(e.responseJSON),ve.processingTwoFactorAuthentication&&N(e)))}),Z(f,c,u)},makeAccountRequest:function(e,n,t,o,r,i){return ve.makeOsRequest("accounts",e,n,t,o,r,i)},initializingAccount:!1,setSelectedAccount:function(e,t,o){if(ve.accountMap[e]){e!==ve.selectedAccountId&&ve.log("Setting account: "+(e&&e.length?e.substring(0,e.length/2):e)+".."),ve.lastSnapshot=void 0,ve.selectedAccount=ve.accountMap[e],ve.selectedAccountId=e,ve.initializingAccount=!0;var r=n.Deferred();return A(function(){f()&&s("selectedAccount:"+ie,e),ve.initializingAccount=!1,r.resolve()},function(n){if(ve.isTwoFactorAuthenticationRequired(n)){var t=_(n.responseJSON);t&&t.then(function(){r.resolve()},function(t){t.requiresUserInput?ve.setSelectedAccount(e):k(r,n)})}else ve.isReLoginRequired(n)?ve.reLogin().then(function(){return ve.setSelectedAccount(e)}).then(function(){C(!0),r.resolve()},function(e){r.reject(e)}):k(r,n)}),Z(r,t,o)}ve.error("Can't set account id to: "+e)},isReLoginRequired:function(e){return ve.isErrorCode(e,1005)},isTokenExpiredCode:function(e){return ve.isErrorCode(e,1007)},isTwoFactorAuthenticationRequired:function(e){return ve.isErrorCode(e,2701)},isErrorCode:function(e,n){return!!e&&!!e.responseJSON&&403===e.responseJSON.httpStatus&&e.responseJSON.code===n},excludeCurrentAccount:function(){var e=ve.selectedAccountId,n=ve.accounts.indexOf(ve.selectedAccount);n>-1&&(ve.accounts.splice(n,1),delete ve.accountMap[e],ve.accountIdsToExclude.push(e))},getInstrumentFromSymbol:function(e){return e?ve.getInstrumentForProperty(ve.availableInstruments,"symbol",e):null},getInstrumentFromId:function(e){return e&&ve.tradingEnabled?O(e)?ve.getInstrumentForProperty(ve.availableInstruments,"instrumentId",e):(ve.warn("Instrument Id not found..."),null):null},getInstrumentFromBrokerageAccountSymbol:function(e){return ve.getInstrumentForProperty(ve.availableInstruments,"brokerageAccountSymbol",e)},getInstrumentForProperty:function(e,t,o){var r=null;return n(e).each(function(e,n){if(n[t].toUpperCase()===o.toUpperCase())return r=n,!1}),r},roundPrice:function(e,n){return ve.roundNumber(e,n,"price",!1)},roundPriceWithIncrement:function(e,n){return ve.roundNumber(e,n,"price",!0)},roundAmount:function(e,n){return ve.roundNumber(e,n,"amount",!1)},roundAmountWithIncrement:function(e,n){return ve.roundNumber(e,n,"amount",!0)},roundNumber:function(e,n,t,o){var r=ve.getInstrumentFromId(e);if(r&&"number"==typeof n){var i=r.decimals,c=1/Math.pow(10,i),u=t&&"price"!==t?ve.getSizeBand(r,n):ve.getPriceBand(r,n);u&&(i=u.decimals,o&&(c=u.increment));var a=Math.pow(10,i),s=c*Math.round(n/c);return Math.round(s*a)/a}return ve.warn("number"!=typeof n?"Invalid number: "+n:"'"+e+"' instrument not found"),null},getPriceBand:function(e,n){return ve.findBandForValue(e.priceIncrements.priceIncrementBands,n)},getSizeBand:function(e,n){return ve.findBandForValue(e.orderSizeIncrements.orderSizeIncrementBands,n)},findBandForValue:function(e,t){var o=null;return n(e).each(function(e,n){return n.lowerBound<=t&&void(o=n)}),o},calculatePipSize:function(e){var n=ve.getInstrumentFromId(e);if(!n)throw"Instrument not found for the given instrumentId: "+e;var t=n.pipPrecision;return t>0?1/Math.pow(10,t):1},calculatePipDistance:function(e,n,t){var o=ve.getInstrumentFromId(e);if(!o)throw"Instrument not found for the given instrumentId: "+e;var r=o.pipPrecision?o.pipPrecision:0,i=(t-n)*Math.pow(10,r);return Math.round(10*i)/10},calculateExpectedProfitOrLoss:function(e,n,t){return Math.round(e*n*t*100)/100},calculatePositionSizeForRiskPercentage:function(e,n,t,o,r){return ve.calculatePositionSize(e,n,!1,t,o,r)},calculatePositionSizeForRiskAmount:function(e,n,t,o,r){return ve.calculatePositionSize(e,n,!0,t,o,r)},calculatePositionSize:function(e,n,t,o,r,i){var c=i;if(!c&&ve.lastSnapshot)c=ve.lastSnapshot.metrics.equity;else if(!i)throw"Please provide the equity or subscribe to account updates before calling calculatePositionSizeForAccount.";if(!t&&n>100)throw"Please provide a valid risk value: riskIsMoney is false but the provided risk is not a percentage..";var u=t?n:c*n/100,a=u/o/r,s=ve.getInstrumentFromId(e);if(s.multipleOfMinAmount)a=Math.floor(a/s.minAmount)*s.minAmount;else{var d=h(s.minAmount),l=Math.pow(10,d);a=Math.floor(a*l)/l}return a},getAccountById:function(e){return ve.accountMap[e]},getUser:function(e,n){return ve.makeOsRequest("user","GET","","",null,e,n)},getAppInfo:function(e,n){return ve.makeOsRequest("apps","GET","",ve.app_id,null,e,n)},getBrokers:function(e,n){return ve.makeOsRequest("brokers","GET","","",null,e,n)},APP_KEY_MISSING:"Please specify your 'appKey' in the tradable config object or the 'data-app-key' attribute in the tradable core script tag.",authenticateWithCredentials:function(e,t,o,r,i,c){var u=new n.Deferred;"function"==typeof r&&("function"==typeof i&&(c=i),i=r),R();var a={appId:ve.app_id,brokerId:e,login:t,password:o};if(!ve.app_key)throw ve.APP_KEY_MISSING;return a.appKey=ve.app_key,"string"==typeof r?a.externalId=r:"undefined"!=typeof ve.external_id&&(a.externalId=ve.external_id),ve.makeAuthenticationRequest(u,"authenticate",a),Z(u,i,c)},createDemoAccount:function(e,t,o){var r=new n.Deferred,i={appId:ve.app_id,type:e};if(!ve.app_key)throw ve.APP_KEY_MISSING;return i.appKey=ve.app_key,ve.makeAuthenticationRequest(r,"createDemoAccount",i),Z(r,t,o)},makeAuthenticationRequest:function(e,n,t){var o;return ve.makeOsRequest(n,"POST","","",t).then(function(e){return o=e,ve.enableTrading(e.apiTokenValue,e.apiEndpoint,e.expires)}).then(function(){e.resolve(o)},function(n){e.reject(n)})},createForexDemoAccount:function(e,n){return ve.createDemoAccount("FOREX",e,n)},createStocksDemoAccount:function(e,n){return ve.createDemoAccount("STOCKS",e,n)},refreshAuthentication:function(e,t,o,r){var i=new n.Deferred,c={refreshTokenValue:e};return t&&(c={refreshTokenValue:e,appSecret:t}),ve.makeAuthenticationRequest(i,"refreshAuthentication",c),Z(i,o,r)},getAccounts:function(e,t){var o=ve.makeAccountRequest("GET","","",null).then(function(e){ve.accounts.splice(0,ve.accounts.length),ve.allAccounts.splice(0,ve.allAccounts.length),ve.accountMap={},n(e.accounts).each(function(e,n){n.uniqueId&&"NA"!==n.uniqueId&&ve.accountIdsToExclude.indexOf(n.uniqueId)<=-1&&(ve.accounts.push(n),ve.accountMap[n.uniqueId]=n),ve.allAccounts.push(n)}),ve.log("Accounts initialized")});return Z(o,e,t)},getCandles:function(e,n,t,o,r,i){return ve.getCandlesForAccount(ve.selectedAccountId,e,n,t,o,r,i)},getCandlesForAccount:function(e,n,t,o,r,i,c){var u={instrumentId:n,from:t,to:o,aggregation:r};return ve.makeAccountRequest("POST",e,"candles/",u,i,c)},subscribedCandleId:void 0,lastReceivedCandle:void 0,startCandleUpdates:function(e,t,o,r){function i(){ve.on("internalCandleUpdates","accountUpdated",function(t){var o=u(e,t.prices);if(ve.lastReceivedCandle&&o&&o.bid){var i=JSON.stringify(n.extend({},ve.lastReceivedCandle));if(c(o,a),i!==JSON.stringify(ve.lastReceivedCandle)){var s=[];return s.push(ve.lastReceivedCandle),r(s)}}})}function c(e,n){var t=e.bid;if(Date.now()-ve.lastReceivedCandle.timestamp>=n){ve.lastReceivedCandle.timestamp=ve.lastReceivedCandle.timestamp+n;var o=ve.lastReceivedCandle.close;ve.lastReceivedCandle.open=o,ve.lastReceivedCandle.high=o,ve.lastReceivedCandle.low=o}ve.lastReceivedCandle.close=t,t>ve.lastReceivedCandle.high&&(ve.lastReceivedCandle.high=t),t<ve.lastReceivedCandle.low&&(ve.lastReceivedCandle.low=t)}function u(e,t){var o=null;return n(t).each(function(n,t){if(t.instrumentId===e)return o=t,!1}),o}ve.stopCandleUpdates();var a=60*o*1e3;ve.subscribedCandleId=e,ve.addInstrumentIdToUpdates("internalCandleUpdates",ve.subscribedCandleId),ve.getCandles(e,t,Date.now(),o).then(function(e){return ve.lastReceivedCandle=e.candles[e.candles.length-1],i(),r(e.candles)},function(e){K(e.responseJSON)})},stopCandleUpdates:function(){ve.subscribedCandleId&&(ve.removeInstrumentIdFromUpdates("internalCandleUpdates",ve.subscribedCandleId),ve.off("internalCandleUpdates"),ve.subscribedCandleId=void 0,ve.lastReceivedCandle=void 0)},getSnapshot:function(e,n,t){return ve.getSnapshotForAccount(ve.selectedAccountId,e,n,t)},getSnapshotForAccount:function(e,n,t,o){var r={instrumentIds:n,includeMarginFactors:!1};return ve.makeAccountRequest("POST",e,"",r,t,o)},getInstrumentsFromIds:function(e,n,t){return ve.getInstrumentsFromIdsForAccount(ve.selectedAccountId,e,n,t)},getInstrumentsFromIdsForAccount:function(e,t,o,r){var i=new n.Deferred,c=[];T(e)||(c=w(t));var u=new n.Deferred;if(c.length){var a={instrumentIds:c};ve.makeAccountRequest("POST",e,"instruments/",a).then(function(e){E(e.instruments),u.resolve(ve.availableInstruments)},function(e){i.reject(e)})}else ve.getOrResolveInstrumentsForAccountId(e,u,i);return u.then(function(e){var o=[];n(t).each(function(n,t){var r=ve.getInstrumentForProperty(e,"instrumentId",t);r&&o.push(r)}),i.resolve({instruments:o})},function(e){i.reject(e)}),Z(i,o,r)},getOrResolveInstrumentsForAccountId:function(e,n,t){ve.selectedAccount&&e===ve.selectedAccount.uniqueId?n.resolve(ve.availableInstruments):m(e).then(function(e){n.resolve(e)},function(e){t.reject(e)})},searchInstruments:function(e,n,t){return ve.searchInstrumentsForAccount(ve.selectedAccountId,e,n,t)},searchInstrumentsForAccount:function(e,t,o,r){function i(e,t){var o=new RegExp(c(t),"i");return n.grep(e,function(e){return o.test(e.symbol)||o.test(e.brokerageAccountSymbol)||o.test(e.displayName)||o.test(e.type)})}function c(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function u(e){var t=n.extend({},e),o=["instrumentId","symbol","brokerageAccountSymbol","displayName","shortDescription","type"],r=[];for(var i in t)t.hasOwnProperty(i)&&n.inArray(i,o)<0&&r.push(i);return n(r).each(function(e,n){delete t[n]}),t}var a=new n.Deferred;if(T(e)){var s=new n.Deferred;ve.getOrResolveInstrumentsForAccountId(e,s,a),s.then(function(e){var o=i(e,t),r=[];n(o).each(function(e,n){r.push(u(n))}),a.resolve(r)},function(e){a.reject(e)})}else{var d={query:t};t.length<2?a.resolve([]):ve.makeAccountRequest("POST",e,"instrumentsearch/",d).then(function(e){a.resolve(e.instruments)},function(e){a.reject(e)})}return Z(a,o,r)},getMetrics:function(e,n){return ve.getMetricsForAccount(ve.selectedAccountId,e,n)},getMetricsForAccount:function(e,n,t){return ve.makeAccountRequest("GET",e,"metrics/",null,n,t)},getOrders:function(e,n){return ve.getOrdersForAccount(ve.selectedAccountId,e,n)},getOrdersForAccount:function(e,n,t){return ve.makeAccountRequest("GET",e,"orders/",null,n,t)},placeMarketOrder:function(e,n,t,o,r){return ve.placeOrder(e,0,n,t,"MARKET",o,r)},placeMarketOrderForAccount:function(e,n,t,o,r,i){return ve.placeOrderForAccount(e,n,0,t,o,"MARKET",r,i)},placeLimitOrder:function(e,n,t,o,r,i){return ve.placeOrder(e,n,t,o,"LIMIT",r,i)},placeLimitOrderForAccount:function(e,n,t,o,r,i,c){return ve.placeOrderForAccount(e,n,t,o,r,"LIMIT",i,c)},placeStopOrder:function(e,n,t,o,r,i){return ve.placeOrder(e,n,t,o,"STOP",r,i)},placeStopOrderForAccount:function(e,n,t,o,r,i,c){return ve.placeOrderForAccount(e,n,t,o,r,"STOP",i,c)},placeOrder:function(e,n,t,o,r,i,c){return ve.placeOrderForAccount(ve.selectedAccountId,e,n,t,o,r,i,c)},placeOrderForAccount:function(e,n,t,o,r,i,c,u){var a={amount:n,price:t,side:o,instrumentId:r,type:i};return ve.makeAccountRequest("POST",e,"orders/",a,c,u)},placeProtectedOrder:function(e,n,t,o,r,i,c,u,a,s){return ve.placeProtectedOrderForAccount(ve.selectedAccount.uniqueId,e,n,t,o,r,i,c,u,a,s)},placeProtectedOrderForAccount:function(e,t,o,r,i,c,u,a,s,d,l){
var f=new n.Deferred;try{ve.validateOrderParams(c,r,o,s,u,a)}catch(p){return f.reject(ne(1,p,"Sending wrong params to the 'placeProtectedOrderForAccount' method.")),Z(f,d,l)}var h={amount:t,price:o,side:r,instrumentId:i,type:c},A="MARKET"===c?s:o;return n.extend(h,ve.getOrderProtections(e,i,u,a,A)),f=ve.makeAccountRequest("POST",e,"orders/",h,d,l),Z(f,d,l)},validateOrderParams:function(e,n,t,o,r,i){if("MARKET"===e){if(!(!r&&!i||"number"==typeof o&&o))throw"MARKET orders require a valid 'currentBidOrAskPrice'";if(0!==t)throw"The price for MARKET orders must be 0"}else if("MARKET"!==e&&("number"!=typeof t||!t))throw"LIMIT and STOP orders require a valid order price";var c="MARKET"===e?o:t;if(r&&"BUY"===n&&r<c||r&&"SELL"===n&&r>c)throw"Take profit order is on the wrong side";if(i&&"BUY"===n&&i>c||i&&"SELL"===n&&i<c)throw"Stop loss order is on the wrong side"},modifyProtectedOrder:function(e,n,t,o,r,i,c){return ve.modifyProtectedOrderForAccount(ve.selectedAccount.uniqueId,e,n,t,o,r,i,c)},modifyProtectedOrderForAccount:function(e,t,o,r,i,c,u,a){var s=o&&o!==t.price?o:t.price,d=t.price!==s?{price:s}:{},l="MARKET"===t.type?c:s,f=ve.getOrderProtections(e,t.instrumentId,r,i,l);return ve.verifyProtectionModification(t,f,"takeProfit"),ve.verifyProtectionModification(t,f,"stopLoss"),n.extend(d,f),ve.makeAccountRequest("PUT",e,"orders/"+t.id,d,u,a)},verifyProtectionModification:function(e,n,t){(n[t]===e[t]||e[t]&&n[t]&&n[t].value===e[t].value&&n[t].entryType===e[t].entryType)&&delete n[t]},getOrderProtections:function(e,t,o,r,i){function c(e,n,t,o){return null===n?n:{entryType:o,value:"DISTANCE"===o?ve.roundPrice(e,Math.abs(t-n)):n}}var u=ve.accountMap[e],a=u.protectionEntryTypes.entryTypes,s={};if(a.length){var d=n.inArray("ABSOLUTE",a)!==-1?"ABSOLUTE":"DISTANCE";"undefined"!=typeof o&&(s.takeProfit=c(t,o,i,d)),"undefined"!=typeof r&&(s.stopLoss=c(t,r,i,d))}return s},cancelTakeProfitOnOrder:function(e,n,t){return ve.cancelTakeProfitOnOrderForAccount(ve.selectedAccount.uniqueId,e,n,t)},cancelTakeProfitOnOrderForAccount:function(e,n,t,o){return ve.makeAccountRequest("PUT",e,"orders/"+n,{takeProfit:null},t,o)},cancelStopLossOnOrder:function(e,n,t){return ve.cancelStopLossOnOrderForAccount(ve.selectedAccount.uniqueId,e,n,t)},cancelStopLossOnOrderForAccount:function(e,n,t,o){return ve.makeAccountRequest("PUT",e,"orders/"+n,{stopLoss:null},t,o)},getPendingOrders:function(e,n){return ve.getPendingOrdersForAccount(ve.selectedAccountId,e,n)},getPendingOrdersForAccount:function(e,n,t){return ve.makeAccountRequest("GET",e,"orders/pending",null,n,t)},getOrderById:function(e,n,t){return ve.getOrderByIdForAccount(ve.selectedAccountId,e,n,t)},getOrderByIdForAccount:function(e,n,t,o){return ve.makeAccountRequest("GET",e,"orders/"+n,null,t,o)},modifyOrderPrice:function(e,n,t,o){return ve.modifyOrderPriceForAccount(ve.selectedAccountId,e,n,t,o)},modifyOrderPriceForAccount:function(e,n,t,o,r){return ve.makeAccountRequest("PUT",e,"orders/"+n,{price:t},o,r)},cancelOrder:function(e,n,t){return ve.cancelOrderForAccount(ve.selectedAccountId,e,n,t)},cancelOrderForAccount:function(e,n,t,o){return ve.makeAccountRequest("DELETE",e,"orders/"+n,null,t,o)},getPositions:function(e,n){return ve.getPositionsForAccount(ve.selectedAccountId,e,n)},getPositionsForAccount:function(e,n,t){return ve.makeAccountRequest("GET",e,"positions/",null,n,t)},closeAllPositions:function(e,n){return ve.closeAllPositionsForAccount(ve.selectedAccountId,e,n)},closeAllPositionsForAccount:function(e,n,t){return ve.makeAccountRequest("DELETE",e,"positions/",null,n,t)},getOpenPositions:function(e,n){return ve.getOpenPositionsForAccount(ve.selectedAccountId,e,n)},getOpenPositionsForAccount:function(e,n,t){return ve.makeAccountRequest("GET",e,"positions/open",null,n,t)},getPositionById:function(e,n,t){return ve.getPositionByIdForAccount(ve.selectedAccountId,e,n,t)},getPositionByIdForAccount:function(e,n,t,o){return ve.makeAccountRequest("GET",e,"positions/"+n,null,t,o)},reducePositionToAmount:function(e,n,t,o){return ve.reducePositionToAmountForAccount(ve.selectedAccountId,e,n,t,o)},reducePositionToAmountForAccount:function(e,n,t,o,r){var i={amount:t};return ve.makeAccountRequest("PUT",e,"positions/"+n,i,o,r)},closePosition:function(e,n,t){return ve.closePositionForAccount(ve.selectedAccountId,e,n,t)},closePositionForAccount:function(e,n,t,o){return ve.makeAccountRequest("DELETE",e,"positions/"+n,null,t,o)},addOrModifyProtections:function(e,n,t,o,r){return ve.addOrModifyProtectionsForAccount(ve.selectedAccountId,e,n,t,o,r)},addOrModifyProtectionsForAccount:function(e,n,t,o,r,i){var c={};return null!==t&&(c.takeprofit=t),null!==o&&(c.stoploss=o),ve.makeAccountRequest("PUT",e,"positions/"+n+"/protections/",c,r,i)},cancelProtections:function(e,n,t){return ve.cancelProtectionsForAccount(ve.selectedAccountId,e,n,t)},cancelProtectionsForAccount:function(e,n,t,o){return ve.makeAccountRequest("DELETE",e,"positions/"+n+"/protections/",null,t,o)},addOrModifyTakeProfit:function(e,n,t,o){return ve.makeProtectionRequest("PUT",e,n,"TAKEPROFIT",t,o)},addOrModifyTakeProfitForAccount:function(e,n,t,o,r){return ve.makeProtectionRequestForAccount("PUT",e,n,t,"TAKEPROFIT",o,r)},addOrModifyStopLoss:function(e,n,t,o){return ve.makeProtectionRequest("PUT",e,n,"STOPLOSS",t,o)},addOrModifyStopLossForAccount:function(e,n,t,o,r){return ve.makeProtectionRequestForAccount("PUT",e,n,t,"STOPLOSS",o,r)},cancelTakeProfit:function(e,n,t){return ve.makeProtectionRequest("DELETE",e,0,"TAKEPROFIT",n,t)},cancelTakeProfitForAccount:function(e,n,t,o){return ve.makeProtectionRequestForAccount("DELETE",e,n,0,"TAKEPROFIT",t,o)},cancelStopLoss:function(e,n,t){return ve.makeProtectionRequest("DELETE",e,0,"STOPLOSS",n,t)},cancelStopLossForAccount:function(e,n,t,o){return ve.makeProtectionRequestForAccount("DELETE",e,n,0,"STOPLOSS",t,o)},makeProtectionRequest:function(e,n,t,o,r,i){return ve.makeProtectionRequestForAccount(e,ve.selectedAccountId,n,t,o,r,i)},makeProtectionRequestForAccount:function(e,n,t,o,r,i,c){var u={price:o};return"DELETE"===e&&(u=null),ve.makeAccountRequest(e,n,"positions/"+t+"/protections/"+r,u,i,c)},getPrices:function(e,n,t){return ve.getPricesForAccount(ve.selectedAccountId,e,n,t)},getPricesForAccount:function(e,t,o,r){var i={instrumentIds:t};if(T(e)||e!==ve.selectedAccount.uniqueId)return ve.makeAccountRequest("POST",e,"prices/",i,o,r);var c,u=new n.Deferred,a=w(t);return c=a.length?ve.getInstrumentsFromIdsForAccount(e,a).then(function(){return ve.makeAccountRequest("POST",e,"prices/",i)}):ve.makeAccountRequest("POST",e,"prices/",i),c.then(function(e){u.resolve(e)},function(e){u.reject(e)}),Z(u,o,r)},makeCandleRequest:function(e,t,o,r,i){var c={instrumentIds:t};"getQuotes"===e&&(c={symbols:t}),i&&(c=i);var u=n.ajax({type:"POST",crossDomain:!0,url:"https://candles-api.tradable.com/"+e,contentType:"application/json; charset=utf-8",data:JSON.stringify(c),dataType:"json"}),a=new n.Deferred;return u.then(function(e){return e.dailyClose?a.resolve(e.dailyClose):a.resolve(e)},function(e,n,t){return a.reject(e,n,t)}),Z(a,o,r)},getLastDailyClose:function(e,n,t){return ve.makeCandleRequest("dailyClose",e,n,t)},initializeWithToken:function(e,n,t,o,r){e&&n&&(ve.accessToken=e,ve.authEndpoint=n,f()&&(s("accessToken:"+ie,ve.accessToken),s("authEndpoint:"+ie,ve.authEndpoint),t&&(ve.expirationTimeUTC=(new Date).getTime()+1e3*parseInt(t,10),s("expirationTimeUTC:"+ie,ve.expirationTimeUTC))));var i=ve.getAccounts();return Z(i,o,r)},reLogin:function(e,n){return ve.reLoginForAccount(ve.selectedAccount.uniqueId,e,n)},reLoginForAccount:function(e,n,t){var o={},r=ve.makeAccountRequest("POST",e,"reLogin/",o).then(function(){ve.initializingAccount||C(!0)});return Z(r,n,t)},submitTwoFactorAuthenticationCode:function(e){ve.currentTwoFactorChallenge&&ve.processingTwoFactorAuthentication?M(n.extend(ve.currentTwoFactorChallenge,{userInput:e})):ve.warn("submitTwoFactorAuthenticationCode was called but no two factor challenge is being handled right now.")},enableTrading:function(e,t,o,r){var i=new n.Deferred;ve.log("Enabling Trading..."),G("embedStarting"),ve.tradingEnabled=!1,ve.lastSnapshot=void 0;var c=ve.accounts.length;return ve.initializeWithToken(e,t,o).then(function(){return U(r,c)}).then(function(){i.resolve()},function(e){i.reject(e)}),i}};ve.log("Starting v_"+ve.version),t(),ve.getTokenValuesFromHashFragment=o;var Te=[],Ie={},ye=!1;ve.processingTwoFactorAuthentication=!1,ve.TWO_FACTOR_AUTH="twoFactorAuthentication",ve.TWO_FACTOR_AUTH_STATUS={RECEIVED:"received",PASSED:"passed",FAILED:"failed"};var be,Oe,Ee=0;e.trEmbJQ=trEmbJQ,e.tradable=ve,e.tradableEmbed=ve,"function"==typeof define&&define&&define.amd?define("tradable-core",[],ve):"function"==typeof require&&"object"==typeof module&&module&&module.exports&&(module.exports=ve)}(jsGlobalObject,trEmbJQ);