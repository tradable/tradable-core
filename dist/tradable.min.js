/******  Copyright 2016 Tradable ApS; @license MIT; v1.21  ******/
function isGreaterOrEqualMinVersion(e,t){return this.toNum=function(e){return parseInt(e,10)},this.highest=function(e,t){for(var n=e.split(".").map(this.toNum),o=t.split(".").map(this.toNum),r=0;r<n.length;r++)if(n[r]!==o[r])return n[r]>o[r]?e:t;return o.length>n.length?t:void 0},!("undefined"!=typeof highest(e,t)&&highest(e,t)===t)}"undefined"!=typeof console&&"function"==typeof console.log&&"function"==typeof console.warn&&"function"==typeof console.error||(console={log:function(){},warn:function(){},error:function(){}}),"undefined"==typeof jQuery?console.warn("tradable requires jQuery to run"):isGreaterOrEqualMinVersion(jQuery.fn.jquery,"2.1.4")||console.warn("tradable requires jQuery version 2.1.4 or above");var trEmbJQ=jQuery.noConflict(!0),jsGlobalObject="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:this;!function(e,t){"use strict";function n(){function e(e,t){t.tradingEnabled=!1,u()&&localStorage.setItem("tradingEnabled:"+Y,!1);var n=o(e);return n.accessToken&&n.endPoint?(t.enableTrading(n.accessToken,n.endPoint,n.expiresIn),"osLaunch"===window.name&&window.close(),!0):!1}var n=!1,r=window.opener;if(r&&"osBrokerSignUp"===window.name)window.close();else if(r&&"osLaunch"===window.name){var i=window.location.hash;if(i){try{r.postMessage("replace your location","*"),n=e(i,r.tradable)}catch(c){n=!1}n||(n=e(i,se))}}else window.location.hash&&-1!==window.location.hash.indexOf("access_token")&&-1!==window.location.hash.indexOf("endpointURL")&&-1!==window.location.hash.indexOf("expires_in")?n=e(window.location.hash,se):se.tradingEnabled&&(E(),n=!0);n||(se.log("Initiating without authentication..."),t(document).ready(function(){w()}))}function o(e){var n={accessToken:void 0,endPoint:void 0,expiresIn:void 0},o=e.replace("#","").split("&");return t(o).each(function(e,t){var o=t.split("="),r=o[0],i=o[1];"access_token"===r?n.accessToken=i:"endpointURL"===r?n.endPoint=i:"expires_in"===r&&(n.expiresIn=i)}),n}function r(){var n="undefined"!=typeof e.tradableEmbedConfig?e.tradableEmbedConfig:e.tradableConfig;if("undefined"==typeof n){var o=0!==t("#tradable-embed").length?"#tradable-embed":0!==t("#tradable").length?"#tradable":"#tradable-api";n={appId:t(o).attr("data-app-id"),appKey:t(o).attr("data-app-key"),redirectURI:t(o).attr("data-redirect-uri"),customOAuthURL:t(o).attr("data-custom-oauth-url"),customOAuthHost:t(o).attr("data-custom-oauth-host")}}return n}function i(){var e=tradableConfig.redirectURI?tradableConfig.redirectURI:location.href;return encodeURIComponent(e)}function c(e){var t={},n=tradableConfig.customOAuthURL,o=tradableConfig.customOAuthHost,r="api.tradable.com/";Y>2e5&&(r="api-staging.tradable.com/",se.log("Starting in staging mode...")),o&&(r=o);var i="https://"+r+"oauth/authorize?client_id="+Y+"&scope=trade&response_type=token&redirect_uri="+e,c=n?n:i;return t.oauthHost=r,t.oauthURL=c,t}function a(){var e={};return e.token=localStorage.getItem("accessToken:"+Y),e.authEndpoint=localStorage.getItem("authEndpoint:"+Y),e.tradingEnabled=localStorage.getItem("tradingEnabled:"+Y),e.expirationTimeUTC=localStorage.getItem("expirationTimeUTC:"+Y),!e.tradingEnabled||e.authEndpoint&&e.token&&e.expirationTimeUTC||(e.tradingEnabled=!1,u()&&localStorage.setItem("tradingEnabled:"+Y,e.tradingEnabled)),e}function u(){var e="test";try{return localStorage.setItem(e,"1"),localStorage.removeItem(e),!0}catch(t){return!1}}function s(e,t){var n=window.screenLeft?window.screenLeft:window.screenX,o=window.screenTop?window.screenTop:window.screenY,r=420,i=500,c=n+window.innerWidth/2-r/2,a=o+window.innerHeight/2-i/2;return window.open(e,t,"toolbar=no, titlebar=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+r+", height="+i+", top="+a+", left="+c)}function d(e){if("number"!=typeof e)return 0;var t=String(e).replace(",",".").split(".")[1];return t?t.length:0}function l(e,n){var o=!1;se.tradingEnabled&&(se.tradingEnabled=!1,o=!0),v();var r=new t.Deferred;return m().then(function(){se.log("Instruments ready"),o&&(se.tradingEnabled=!0,x()),r.resolve(se.accounts)},function(e){r.reject(e)}),B(r,e,n)}function f(e,t){return p(se.selectedAccountId,e,t)}function p(e,t,n){return se.makeAccountRequest("GET",e,"instruments/",null,t,n)}function h(){return"FULL_INSTRUMENT_LIST"===se.selectedAccount.instrumentRetrieval}function g(e){var n=!0;return t(se.accounts).each(function(t,o){o.uniqueId===e&&"FULL_INSTRUMENT_LIST"!==o.instrumentRetrieval&&(n=!1)}),n}function m(){var e=new t.Deferred;return h()?f().then(function(t){y(t),e.resolve(se.availableInstruments)},function(t){e.reject(t)}):(fe=[],se.searchInstruments("EUR").then(function(e){return A(e),se.searchInstruments("AUD")}).then(function(e){return A(e),se.searchInstruments("USD")}).then(function(e){return A(e),se.getPrices(fe)}).then(function(){e.resolve(se.availableInstruments)},function(t){e.reject(t)})),e}function A(e){var n=0;t(e).each(function(e,t){(6===t.symbol.length||7===t.symbol.length)&&16>n&&(fe.push(t.instrumentId),n++)})}function v(){se.availableCategories.splice(0,se.availableCategories.length),se.availableInstruments.splice(0,se.availableInstruments.length),se.availableSymbols.splice(0,se.availableSymbols.length),se.availableCurrencies.splice(0,se.availableCurrencies.length),se.instrumentKeysForAccountUpdates.splice(0,se.instrumentKeysForAccountUpdates.length),pe={}}function I(e){return"undefined"!=typeof pe[e]}function y(e){function n(e){var n=["100","200","225","spx","h33","nas","u30","e50","f40","d30","e35","i40","z30","s30","uso","uko"];-1===t.inArray(e,se.availableCurrencies)&&-1===t.inArray(e,n)&&se.availableCurrencies.push(e)}t(e).each(function(e,o){if(!I(o.instrumentId)){se.availableInstruments.push(o),se.availableSymbols.push(o.symbol);var r=o.symbol.replace("/","");if(("FOREX"===o.type||"CFD"===o.type)&&6===r.length){var i=r.toLowerCase().substring(0,3),c=r.toLowerCase().substring(3,6);n(i),n(c)}-1===t.inArray(o.type,se.availableCategories)&&se.availableCategories.push(o.type),pe[o.instrumentId]=!0}})}function T(e){var n=[];return t(e).each(function(e,t){I(t)||n.push(t)}),n}function b(){se.instrumentKeysForAccountUpdates.length&&se.instrumentKeysForAccountUpdates.splice(0,se.instrumentKeysForAccountUpdates.length)}function O(){se.accountIdsToExclude.splice(0,se.accountIdsToExclude.length)}function P(e,t){var n=se.accounts.length;se.excludeCurrentAccount(),se.log("Account initialization failed.."),se.accounts.length>0?(se.log("Resetting to previous account"),R(!1,n).then(function(){se.initializingAccount=!1},function(){se.initializingAccount=!1})):(se.log("No more accounts available, signing out.."),se.signOut(),se.initializingAccount=!1),e.reject(t)}function E(){se.log("Validating token..."),se.getAccounts().then(function(){se.enableTrading(se.accessToken,se.authEndpoint)},function(){S(!1)})}function k(e,t){var n,o=localStorage.getItem("selectedAccount:"+Y),r=se.accounts.length-1;return e&&se.accounts.length>t?n=se.accounts[r].uniqueId:o&&se.accountMap[o]?n=o:r>=0&&(n=se.accounts[r].uniqueId),n}function R(e,n){var o=new t.Deferred,r=k(e,n);return b(),r?se.setSelectedAccount(r,function(){S(!0),o.resolve()},function(e){o.reject(e)}):(se.signOut(),o.reject()),o}function S(e){e!==se.tradingEnabled&&(se.tradingEnabled=e,se.log("Embed ready: "+se.tradingEnabled),u()&&localStorage.setItem("tradingEnabled:"+Y,se.tradingEnabled),w())}function w(){t(se.readyCallbacks).each(function(e,t){_(t)}),M("embedReady"),se.notifiedCallbacks=!0}function U(){if(se.tradingEnabled&&!se.initializingAccount&&!he&&(re.length>0||void 0!==typeof ne.accountUpdated)){var e=se.selectedAccountId;he=!0;var n=[];t(se.instrumentKeysForAccountUpdates).each(function(e,o){var r=o.substring(0,o.indexOf(":"));-1===t.inArray(r,n)&&n.push(r)}),se.getSnapshot(n).then(function(n){return e===se.selectedAccountId?(se.lastSnapshot=n,F(n)):(new t.Deferred).reject()}).then(function(e){se.tradingEnabled&&!se.initializingAccount&&(t.each(re,function(t,n){_(n,e)}),M("accountUpdated",e)),he=!1},function(){he=!1})}}function F(e){var n=new t.Deferred;if(h())n.resolve(e);else{var o=[],r=function(e,t){I(t.instrumentId)||o.push(t.instrumentId)};t(e.positions.open).each(r),t(e.orders.pending).each(r),o.length?se.getInstrumentsFromIds(o).then(function(){n.resolve(e)},function(e){n.reject(e)}):n.resolve(e)}return n}function C(){se.log("Token expired"),S(!1),t(ce).each(function(e,t){_(t)}),M("tokenExpired")}function q(e){t(ue).each(function(t,n){_(n,e)}),M("error",e)}function x(){se.log("Account switched: "+se.selectedAccount.displayName),t(oe).each(function(e,t){_(t)}),M("accountSwitch")}function L(){S(!1),M("reLoginRequired")}function M(e,t){if(se.isEventValid(e)){if(void 0!==typeof ne[e])for(var n in ne[e])ne[e].hasOwnProperty(n)&&_(ne[e][n],t)}else se.error("Careful, can't notify '"+e+"', it's an invalid event name")}function _(e,t){try{if(t)return e(t);e()}catch(n){se.error(n)}}function D(e){se.selectedAccount.uniqueId!==de&&(N(),de=se.selectedAccount.uniqueId),le||(le=new j,le.orders=K(e.orders.pending,"orders",!0),le.cancelledOrders=K(e.orders.recentlyCancelled,"cancelledOrders",!0),le.positions=K(e.positions.open,"positions",!0),le.closedPositions=K(e.positions.recentlyClosed,"closedPositions",!0));var t=new j(K(e.orders.pending,"orders"),K(e.orders.recentlyCancelled,"cancelledOrders"),K(e.positions.open,"positions"),K(e.positions.recentlyClosed,"closedPositions"));return t.getTotal()>0&&M("execution",t),t}function N(){le=void 0}function j(e,t,n,o){this.orders=e?e:[],this.cancelledOrders=t?t:[],this.positions=n?n:[],this.closedPositions=o?o:[],this.getTotal=function(){return this.orders.length+this.cancelledOrders.length+this.positions.length+this.closedPositions.length}}function K(e,n,o){for(var r=[],i=0;i<e.length;i++){var c=e[i],a=W(c);G(n,c.id,a)&&(le.positions=z(c.id,le.positions)),(!c.type||"MARKET"!==c.type)&&t.inArray(a,le[n])<0&&(r.push(o?a:c),le[n].push(a))}return r}function G(e,n,o){var r=!1;return("positions"===e||"closedPositions"===e)&&t.inArray(o,le[e])<0&&t(le.positions).each(function(e,t){t.indexOf(n)>-1&&(r=!0)}),r}function z(e,n){return t.grep(n,function(t){return t.indexOf(e)<0})}function W(e){return e.id+(e.type?"":0!==e.amount?e.side+e.amount:e.lastModified)}function B(e,t,n){return t||n?e.then(function(e){return"function"==typeof t?t(e):void 0},function(e,t,o){return"function"==typeof n?n(e,t,o):void 0}):e.promise()}function J(){var e=new t.Deferred;if(se.selectedAccount.brokerId<0&&1===se.allAccounts.length)return e.resolve(),e;var n={tokenValue:se.accessToken};return se.makeOsRequest("internal","POST","","signOut",n).then(function(){e.resolve()},function(){e.reject()}),e}function V(e){var t,n,o=0;if(0===e.length)return o;for(t=0;t<e.length;t++)n=e.charCodeAt(t),o=(o<<5)-o+n,o&=o;return o}function H(){return-1!==navigator.userAgent.indexOf("MSIE")||/rv:11.0/i.test(navigator.userAgent)}function Q(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}e.tradableConfig=r();var Y=tradableConfig.appId,X=tradableConfig.appKey,$=i(),Z=c($),ee=a(),te=["embedStarting","embedReady","accountUpdated","accountSwitch","tokenExpired","tokenWillExpire","reLoginRequired","execution","error"],ne={},oe=[],re=[],ie=[],ce=[],ae=[],ue=[],se={version:"1.21",app_id:Y,app_key:X,oauth_host:Z.oauthHost,auth_loc:Z.oauthURL,external_id:void 0,login_loc:Z.oauthURL+"&showLogin=true",approval_page_loc:Z.oauthURL+"&showApproval=true",broker_signup_loc:"https://"+Z.oauthHost+"brokerSignup?client_id="+Y+"&redirect_uri="+$,auth_window:null,authEndpoint:ee.authEndpoint,accessToken:ee.token,tradingEnabled:ee.tradingEnabled,expirationTimeUTC:ee.expirationTimeUTC,notifiedCallbacks:!1,readyCallbacks:[],allAccounts:[],accounts:[],accountIdsToExclude:[],accountMap:{},selectedAccount:null,selectedAccountId:null,availableCategories:[],availableInstruments:[],availableSymbols:[],availableCurrencies:[],lastSnapshot:null,instrumentKeysForAccountUpdates:[],accountUpdateMillis:700,log:function(e){console.log("[TR] "+e)},warn:function(e){console.warn("[TR] "+e)},error:function(e){console.error("[TR] "+e)},showApprovalPage:function(){se.openOAuthPage("APPROVAL",!0)},showApprovalPageInWindow:function(){se.openOAuthPage("APPROVAL",!1)},authenticate:function(e){se.tradingEnabled?E():se.openOAuthPage("AUTHENTICATE",!0,e)},authenticateWithWindow:function(e){se.openOAuthPage("AUTHENTICATE",!1,e)},showLoginPage:function(e){se.openOAuthPage("LOGIN",!0,e)},showLoginPageInWindow:function(e){se.openOAuthPage("LOGIN",!1,e)},showBrokerSignUpPage:function(){se.openOAuthPage("BROKER_SIGNUP",!0)},showBrokerSignUpPageInWindow:function(){se.openOAuthPage("BROKER_SIGNUP",!1)},setExternalId:function(e){se.external_id=e},getOAuthUrl:function(e,t){var n="AUTHENTICATE"===e.toUpperCase()?se.auth_loc:"LOGIN"===e.toUpperCase()?se.login_loc:"APPROVAL"===e.toUpperCase()?se.approval_page_loc:"BROKER_SIGNUP"===e.toUpperCase()?se.broker_signup_loc:void 0;if(!n)throw"Choose a correct type: AUTHENTICATE, LOGIN, APPROVAL or BROKER_SIGNUP";return"undefined"!=typeof t&&(n=n+"&broker_id="+t),"AUTHENTICATE"!==e.toUpperCase()&&"LOGIN"!==e.toUpperCase()||"undefined"!=typeof se.external_id&&(n=n+"&external_id="+se.external_id),n},openOAuthPage:function(e,t,n){var o=se.getOAuthUrl(e,n);if("AUTHENTICATE"!==e.toUpperCase()&&"LOGIN"!==e.toUpperCase()||O(),"undefined"!=typeof t&&t||H())location.href=o;else{var r="BROKER_SIGNUP"===e.toUpperCase()?"osBrokerSignUp":"osLaunch";se.auth_window=s(o,r)}},enableWithAccessToken:function(e,t,n){return se.enableTrading(e,t,n,!0)},signOut:function(){J(),u()&&(localStorage.removeItem("accessToken:"+Y),localStorage.removeItem("authEndpoint:"+Y),localStorage.removeItem("tradingEnabled:"+Y),localStorage.removeItem("expirationTimeUTC:"+Y)),S(!1)},isEventValid:function(e){return"string"==typeof e&&-1!==t.inArray(e,te)},on:function(e,t,n){if(!se.isEventValid(t))throw"Please provide a valid eventName: "+te;if(ne[t]||(ne[t]={}),"string"!=typeof e)throw"The given event namespace is invalid (needs to be a string)";if("undefined"!=typeof ne[t][e])throw"The given event namespace is already taken, 'off' the event first to change it";if("function"!=typeof n)throw"Please provide a valid callback function";switch(t){case"embedReady":se.initEmbedReady(n);break;case"accountUpdated":se.initAccountUpdates();break;case"tokenWillExpire":se.initTokenWillExpire();break;case"execution":se.initExecutions()}ne[t][e]=n},off:function(e,t){if("undefined"==typeof t)for(var n in ne)ne.hasOwnProperty(n)&&e in ne[n]&&ne[n].hasOwnProperty(e)&&delete ne[n][e];else se.isEventValid(t)&&ne[t]&&e in ne[t]&&delete ne[t][e];for(t in ne)if(ne.hasOwnProperty(t)&&Q(ne[t]))switch(delete ne[t],t){case"accountUpdated":se.stopAccountUpdates();break;case"execution":se.stopExecutions()}},initEmbedReady:function(e){return se.notifiedCallbacks?_(e):void 0},onEmbedReady:function(e){if(!e||"function"!=typeof e)throw"The specified callback is not a function";se.readyCallbacks.push(e),se.initEmbedReady(e)},accountUpdateInterval:null,initAccountUpdates:function(){null===se.accountUpdateInterval&&(se.accountUpdateInterval=setInterval(U,se.accountUpdateMillis))},stopAccountUpdates:function(){re.length||(clearInterval(se.accountUpdateInterval),se.accountUpdateInterval=null)},onAccountUpdated:function(e){if(!e||"function"!=typeof e)throw"The specified callback is not a function";se.initAccountUpdates();var n=V(e.toString());-1===t.inArray(n,ie)&&(re.push(e),ie.push(n))},setAccountUpdateFrequencyMillis:function(e){if(!(e&&e>0&&"number"==typeof e))throw"Please specify a valid update frequency";se.accountUpdateMillis=e,se.accountUpdateInterval&&(clearInterval(se.accountUpdateInterval),se.accountUpdateInterval=setInterval(U,se.accountUpdateMillis))},addSymbolToUpdates:function(e,t){se.warn("'addSymbolToUpdates' is now deprecated, 'addInstrumentIdToUpdates' should now be used instead."),se.addInstrumentIdToUpdates(e,t)},removeSymbolFromUpdates:function(e,t){se.warn("'removeSymbolFromUpdates' is now deprecated, 'removeInstrumentIdFromUpdates' should now be used instead."),se.removeInstrumentIdFromUpdates(e,t)},addInstrumentIdToUpdates:function(e,n){if(-1!==e.indexOf(":"))throw"It is not allowed to include a colon ':' in the updateClientId";var o=n+":"+e;-1===t.inArray(o,se.instrumentKeysForAccountUpdates)&&se.instrumentKeysForAccountUpdates.push(o)},removeInstrumentIdFromUpdates:function(e,n){var o=n+":"+e;se.instrumentKeysForAccountUpdates=t.grep(se.instrumentKeysForAccountUpdates,function(e){return e!==o})},onAccountSwitch:function(e){se.saveCallback(e,oe)},onTokenExpired:function(e){se.saveCallback(e,ce)},onError:function(e){se.saveCallback(e,ue)},saveCallback:function(e,n){e&&-1===t.inArray(e,n)&&n.push(e)},tokenWillExpireInterval:null,initTokenWillExpire:function(){function e(){var e=se.getRemainingTokenMillis();e&&e>0&&18e5>e&&(t(ae).each(function(t,n){n(e)}),M("tokenWillExpire",e))}null===se.tokenWillExpireInterval&&(se.tokenWillExpireInterval=setInterval(e,3e5))},onTokenWillExpire:function(e){se.initTokenWillExpire(),-1===t.inArray(e,ae)&&ae.push(e)},getRemainingTokenMillis:function(){return se.expirationTimeUTC||se.log("You need to authenticate before calling this method"),se.expirationTimeUTC-(new Date).getTime()},listeningToExecutions:!1,initExecutions:function(){se.listeningToExecutions||(se.on("internalExecutionsListener","accountUpdated",D),se.listeningToExecutions=!0)},stopExecutions:function(){se.off("internalExecutionsListener","accountUpdated"),se.listeningToExecutions=!1},makeOsRequest:function(e,n,o,r,i,c,a){var u,s="internal"===e?"":"v1/";if("user"!==e&&"accounts"!==e)u="https://"+se.oauth_host;else if(void 0!==o&&null!==o&&0===o.length)u=se.authEndpoint;else{if(!se.accountMap[o]){se.warn("Please specify a valid accountId or method");var d=(new t.Deferred).reject("Invalid request: Please specify a valid accountId or method");return B(d,c,a)}u=se.accountMap[o].endpointURL}var l=t.ajax({type:n,beforeSend:function(t){"internal"!==e&&t.setRequestHeader("Authorization","Bearer "+se.accessToken),t.setRequestHeader("x-tr-embed-sdk","js-"+se.version)},crossDomain:!0,xhrFields:{withCredentials:!0},url:o&&o.length>0?u+s+e+"/"+o+"/"+r:u+s+e+"/"+r,contentType:"application/json; charset=utf-8",data:i?JSON.stringify(i):void 0,dataType:"json"});return l.then(function(){},function(e){e.responseJSON&&(se.initializingAccount||403!==e.responseJSON.httpStatus&&502!==e.responseJSON.httpStatus||(se.isReLoginRequired(e)?L():se.isTokenExpiredCode(e)?C():se.isReLoginRequired(e)||S(!1)),se.isReLoginRequired(e)||q(e.responseJSON))}),B(l,c,a)},makeAccountRequest:function(e,t,n,o,r,i){return se.makeOsRequest("accounts",e,t,n,o,r,i)},initializingAccount:!1,setSelectedAccount:function(e,n,o){if(se.accountMap[e]){se.lastSnapshot=void 0,se.selectedAccount=se.accountMap[e],se.selectedAccountId=e,se.log("Setting account: "+(e&&e.length?e.substring(0,e.length/2):e)+".."),se.initializingAccount=!0;var r=t.Deferred();return l(function(){u()&&localStorage.setItem("selectedAccount:"+Y,e),se.initializingAccount=!1,r.resolve()},function(t){se.isReLoginRequired(t)?se.reLogin().then(function(){se.setSelectedAccount(e).then(function(){S(!0),r.resolve()})},function(){P(r,t)}):P(r,t)}),B(r,n,o)}se.error("Can't set account id to: "+e)},isReLoginRequired:function(e){return!!e&&!!e.responseJSON&&403===e.responseJSON.httpStatus&&1005===e.responseJSON.code},isTokenExpiredCode:function(e){return!!e&&!!e.responseJSON&&403===e.responseJSON.httpStatus&&1007===e.responseJSON.code},excludeCurrentAccount:function(){var e=se.selectedAccountId,t=se.accounts.indexOf(se.selectedAccount);t>-1&&(se.accounts.splice(t,1),delete se.accountMap[e],se.accountIdsToExclude.push(e))},getInstrumentFromSymbol:function(e){return e?se.getInstrumentForProperty(se.availableInstruments,"symbol",e):null},getInstrumentFromId:function(e){return e&&se.tradingEnabled?I(e)?se.getInstrumentForProperty(se.availableInstruments,"instrumentId",e):(se.warn("Instrument Id not found..."),null):null},getInstrumentFromBrokerageAccountSymbol:function(e){return se.getInstrumentForProperty(se.availableInstruments,"brokerageAccountSymbol",e)},getInstrumentForProperty:function(e,n,o){var r=null;return t(e).each(function(e,t){return t[n].toUpperCase()===o.toUpperCase()?(r=t,!1):void 0}),r},calculatePipSize:function(e){var t=se.getInstrumentFromId(e);if(!t)throw"Instrument not found for the given instrumentId: "+e;var n=t.pipPrecision;return n>0?1/Math.pow(10,n):1},calculatePipDistance:function(e,t,n){var o=se.getInstrumentFromId(e);if(!o)throw"Instrument not found for the given instrumentId: "+e;var r=o.pipPrecision?o.pipPrecision:0,i=(n-t)*Math.pow(10,r);return Math.round(10*i)/10},calculateExpectedProfitOrLoss:function(e,t,n){return Math.round(e*t*n*100)/100},calculatePositionSizeForRiskPercentage:function(e,t,n,o,r){return se.calculatePositionSize(e,t,!1,n,o,r)},calculatePositionSizeForRiskAmount:function(e,t,n,o,r){return se.calculatePositionSize(e,t,!0,n,o,r)},calculatePositionSize:function(e,t,n,o,r,i){var c=i;if(!c&&se.lastSnapshot)c=se.lastSnapshot.metrics.equity;else if(!i)throw"Please provide the equity or subscribe to account updates before calling calculatePositionSizeForAccount.";if(!n&&t>100)throw"Please provide a valid risk value: riskIsMoney is false but the provided risk is not a percentage..";var a=n?t:c*t/100,u=a/o/r,s=se.getInstrumentFromId(e);if(s.multipleOfMinAmount)u=Math.floor(u/s.minAmount)*s.minAmount;else{var l=d(s.minAmount),f=Math.pow(10,l);u=Math.floor(u*f)/f}return u},getAccountById:function(e){return se.accountMap[e]},getUser:function(e,t){return se.makeOsRequest("user","GET","","",null,e,t)},getAppInfo:function(e,t){return se.makeOsRequest("apps","GET","",se.app_id,null,e,t)},getBrokers:function(e,t){return se.makeOsRequest("brokers","GET","","",null,e,t)},APP_KEY_MISSING:"Please specify your 'appKey' in the tradable config object or the 'data-app-key' attribute in the tradable core script tag.",authenticateWithCredentials:function(e,n,o,r,i,c){var a=new t.Deferred;"function"==typeof r&&("function"==typeof i&&(c=i),i=r),O();var u={appId:se.app_id,brokerId:e,login:n,password:o};if(!se.app_key)throw se.APP_KEY_MISSING;return u.appKey=se.app_key,"string"==typeof r?u.externalId=r:"undefined"!=typeof se.external_id&&(u.externalId=se.external_id),se.makeAuthenticationRequest(a,"authenticate",u),B(a,i,c)},createDemoAccount:function(e,n,o){var r=new t.Deferred,i={appId:se.app_id,type:e};if(!se.app_key)throw se.APP_KEY_MISSING;return i.appKey=se.app_key,se.makeAuthenticationRequest(r,"createDemoAccount",i),B(r,n,o)},makeAuthenticationRequest:function(e,t,n){var o;return se.makeOsRequest(t,"POST","","",n).then(function(e){return o=e,se.enableTrading(e.apiTokenValue,e.apiEndpoint,e.expires)}).then(function(){e.resolve(o)},function(t){e.reject(t)})},createForexDemoAccount:function(e,t){return se.createDemoAccount("FOREX",e,t)},createStocksDemoAccount:function(e,t){return se.createDemoAccount("STOCKS",e,t)},refreshAuthentication:function(e,n,o,r){var i=new t.Deferred,c={refreshTokenValue:e};return n&&(c={refreshTokenValue:e,appSecret:n}),se.makeAuthenticationRequest(i,"refreshAuthentication",c),B(i,o,r)},getAccounts:function(e,n){var o=se.makeAccountRequest("GET","","",null).then(function(e){se.accounts.splice(0,se.accounts.length),se.allAccounts.splice(0,se.allAccounts.length),se.accountMap={},t(e.accounts).each(function(e,t){t.uniqueId&&"NA"!==t.uniqueId&&se.accountIdsToExclude.indexOf(t.uniqueId)<=-1&&(se.accounts.push(t),se.accountMap[t.uniqueId]=t),se.allAccounts.push(t)}),se.log("Accounts initialized")});return B(o,e,n)},getCandles:function(e,t,n,o,r,i){return se.getCandlesForAccount(se.selectedAccountId,e,t,n,o,r,i)},getCandlesForAccount:function(e,t,n,o,r,i,c){var a={instrumentId:t,from:n,to:o,aggregation:r};return se.makeAccountRequest("POST",e,"candles/",a,i,c)},subscribedCandleId:void 0,lastReceivedCandle:void 0,startCandleUpdates:function(e,n,o,r){function i(){se.on("internalCandleUpdates","accountUpdated",function(n){var o=a(e,n.prices);if(se.lastReceivedCandle&&o&&o.bid){var i=JSON.stringify(t.extend({},se.lastReceivedCandle));if(c(o,u),i!==JSON.stringify(se.lastReceivedCandle)){var s=[];return s.push(se.lastReceivedCandle),r(s)}}})}function c(e,t){var n=e.bid;if(Date.now()-se.lastReceivedCandle.timestamp>=t){se.lastReceivedCandle.timestamp=se.lastReceivedCandle.timestamp+t;var o=se.lastReceivedCandle.close;se.lastReceivedCandle.open=o,se.lastReceivedCandle.high=o,se.lastReceivedCandle.low=o}se.lastReceivedCandle.close=n,n>se.lastReceivedCandle.high&&(se.lastReceivedCandle.high=n),n<se.lastReceivedCandle.low&&(se.lastReceivedCandle.low=n)}function a(e,n){var o=null;return t(n).each(function(t,n){return n.instrumentId===e?(o=n,!1):void 0}),o}se.stopCandleUpdates();var u=60*o*1e3;se.subscribedCandleId=e,se.addInstrumentIdToUpdates("internalCandleUpdates",se.subscribedCandleId),se.getCandles(e,n,Date.now(),o).then(function(e){return se.lastReceivedCandle=e.candles[e.candles.length-1],i(),r(e.candles)},function(e){q(e.responseJSON)})},stopCandleUpdates:function(){se.subscribedCandleId&&(se.removeInstrumentIdFromUpdates("internalCandleUpdates",se.subscribedCandleId),se.off("internalCandleUpdates"),se.subscribedCandleId=void 0,se.lastReceivedCandle=void 0)},getSnapshot:function(e,t,n){return se.getSnapshotForAccount(se.selectedAccountId,e,t,n)},getSnapshotForAccount:function(e,t,n,o){var r={instrumentIds:t,includeMarginFactors:!1};return se.makeAccountRequest("POST",e,"",r,n,o)},getInstrumentsFromIds:function(e,t,n){return se.getInstrumentsFromIdsForAccount(se.selectedAccountId,e,t,n)},getInstrumentsFromIdsForAccount:function(e,n,o,r){var i=new t.Deferred,c=[];g(e)||(c=T(n));var a=new t.Deferred;if(c.length){var u={instrumentIds:c};se.makeAccountRequest("POST",e,"instruments/",u).then(function(e){y(e.instruments),a.resolve(se.availableInstruments)},function(e){i.reject(e)})}else se.getOrResolveInstrumentsForAccountId(e,a,i);return a.then(function(e){var o=[];t(n).each(function(t,n){var r=se.getInstrumentForProperty(e,"instrumentId",n);r&&o.push(r)}),i.resolve({instruments:o})},function(e){i.reject(e)}),B(i,o,r)},getOrResolveInstrumentsForAccountId:function(e,t,n){se.selectedAccount&&e===se.selectedAccount.uniqueId?t.resolve(se.availableInstruments):p(e).then(function(e){t.resolve(e)},function(e){n.reject(e)})},searchInstruments:function(e,t,n){return se.searchInstrumentsForAccount(se.selectedAccountId,e,t,n)},searchInstrumentsForAccount:function(e,n,o,r){function i(e,n){var o=new RegExp(c(n),"i");return t.grep(e,function(e){return o.test(e.symbol)||o.test(e.brokerageAccountSymbol)||o.test(e.displayName)||o.test(e.type)})}function c(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function a(e){var n=t.extend({},e),o=["instrumentId","symbol","brokerageAccountSymbol","displayName","shortDescription","type"],r=[];for(var i in n)n.hasOwnProperty(i)&&t.inArray(i,o)<0&&r.push(i);return t(r).each(function(e,t){delete n[t]}),n}var u=new t.Deferred;if(g(e)){var s=new t.Deferred;se.getOrResolveInstrumentsForAccountId(e,s,u),s.then(function(e){var o=i(e,n),r=[];t(o).each(function(e,t){r.push(a(t))}),u.resolve(r)},function(e){u.reject(e)})}else{var d={query:n};n.length<2?u.resolve([]):se.makeAccountRequest("POST",e,"instrumentsearch/",d).then(function(e){u.resolve(e.instruments)},function(e){u.reject(e)})}return B(u,o,r)},getMetrics:function(e,t){return se.getMetricsForAccount(se.selectedAccountId,e,t)},getMetricsForAccount:function(e,t,n){return se.makeAccountRequest("GET",e,"metrics/",null,t,n)},getOrders:function(e,t){return se.getOrdersForAccount(se.selectedAccountId,e,t)},getOrdersForAccount:function(e,t,n){return se.makeAccountRequest("GET",e,"orders/",null,t,n)},placeMarketOrder:function(e,t,n,o,r){return se.placeOrder(e,0,t,n,"MARKET",o,r)},placeMarketOrderForAccount:function(e,t,n,o,r,i){return se.placeOrderForAccount(e,t,0,n,o,"MARKET",r,i)},placeLimitOrder:function(e,t,n,o,r,i){return se.placeOrder(e,t,n,o,"LIMIT",r,i)},placeLimitOrderForAccount:function(e,t,n,o,r,i,c){return se.placeOrderForAccount(e,t,n,o,r,"LIMIT",i,c)},placeStopOrder:function(e,t,n,o,r,i){return se.placeOrder(e,t,n,o,"STOP",r,i)},placeStopOrderForAccount:function(e,t,n,o,r,i,c){return se.placeOrderForAccount(e,t,n,o,r,"STOP",i,c)},placeOrder:function(e,t,n,o,r,i,c){return se.placeOrderForAccount(se.selectedAccountId,e,t,n,o,r,i,c)},placeOrderForAccount:function(e,t,n,o,r,i,c,a){var u={amount:t,price:n,side:o,instrumentId:r,type:i};return se.makeAccountRequest("POST",e,"orders/",u,c,a)},placeOrderWithProtections:function(e,t,n,o,r,i,c,a,u){return se.placeOrderWithProtectionsForAccount(se.selectedAccountId,e,t,n,o,r,i,c,a,u)},placeOrderWithProtectionsForAccount:function(e,t,n,o,r,i,c,a,u,s){se.warn("placeOrderWithProtections is deprecated and will eventually be removed, please use placeProtectedOrder or placeProtectedOrderForAccount instead.");var d={amount:t,price:n,side:o,instrumentId:r,type:i};return c&&(d.takeProfitDistance=c),a&&(d.stopLossDistance=a),se.makeAccountRequest("POST",e,"orders/",d,u,s)},placeProtectedOrder:function(e,t,n,o,r,i,c,a,u,s){return se.placeProtectedOrderForAccount(se.selectedAccount.uniqueId,e,t,n,o,r,i,c,a,u,s)},placeProtectedOrderForAccount:function(e,n,o,r,i,c,a,u,s,d,l){se.validateOrderParams(c,o,s,a,u);var f={amount:n,price:o,side:r,instrumentId:i,type:c},p="MARKET"===c?s:o;return t.extend(f,se.getOrderProtections(e,a,u,p)),se.makeAccountRequest("POST",e,"orders/",f,d,l)},validateOrderParams:function(e,t,n,o,r){if("MARKET"===e){if(!(!o&&!r||"number"==typeof n&&n))throw"MARKET orders require a valid 'currentBidOrAskPrice'";if(0!==t)throw"The price for MARKET orders must be 0"}else if("MARKET"!==e&&("number"!=typeof t||!t))throw"LIMIT and STOP orders require a valid order price"},modifyProtectedOrder:function(e,t,n,o,r,i,c){return se.modifyProtectedOrderForAccount(se.selectedAccount.uniqueId,e,t,n,o,r,i,c)},modifyProtectedOrderForAccount:function(e,n,o,r,i,c,a,u){var s=o&&o!==n.price?o:n.price,d=n.price!==s?{price:s}:{},l="MARKET"===n.type?c:s,f=se.getOrderProtections(e,r,i,l);return se.verifyProtectionModification(n,f,"takeProfit"),se.verifyProtectionModification(n,f,"stopLoss"),t.extend(d,f),se.makeAccountRequest("PUT",e,"orders/"+n.id,d,a,u)},verifyProtectionModification:function(e,t,n){(t[n]===e[n]||e[n]&&t[n]&&t[n].value===e[n].value&&t[n].entryType===e[n].entryType)&&delete t[n]},getOrderProtections:function(e,n,o,r){function i(e,t,n){return null===e?e:{entryType:n,value:"DISTANCE"===n?Math.abs(t-e):e}}var c=se.accountMap[e],a=c.protectionEntryTypes.entryTypes,u={};if(a.length){var s=-1!==t.inArray("ABSOLUTE",a)?"ABSOLUTE":"DISTANCE";"undefined"!=typeof n&&(u.takeProfit=i(n,r,s)),"undefined"!=typeof o&&(u.stopLoss=i(o,r,s))}return u},cancelTakeProfitOnOrder:function(e,t,n){return se.cancelTakeProfitOnOrderForAccount(se.selectedAccount.uniqueId,e,t,n)},cancelTakeProfitOnOrderForAccount:function(e,t,n,o){return se.makeAccountRequest("PUT",e,"orders/"+t,{takeProfit:null},n,o)},cancelStopLossOnOrder:function(e,t,n){return se.cancelStopLossOnOrderForAccount(se.selectedAccount.uniqueId,e,t,n)},cancelStopLossOnOrderForAccount:function(e,t,n,o){return se.makeAccountRequest("PUT",e,"orders/"+t,{stopLoss:null},n,o)},getPendingOrders:function(e,t){return se.getPendingOrdersForAccount(se.selectedAccountId,e,t)},getPendingOrdersForAccount:function(e,t,n){return se.makeAccountRequest("GET",e,"orders/pending",null,t,n)},getOrderById:function(e,t,n){return se.getOrderByIdForAccount(se.selectedAccountId,e,t,n)},getOrderByIdForAccount:function(e,t,n,o){return se.makeAccountRequest("GET",e,"orders/"+t,null,n,o)},modifyOrderPrice:function(e,t,n,o){return se.modifyOrderPriceForAccount(se.selectedAccountId,e,t,n,o)},modifyOrderPriceForAccount:function(e,t,n,o,r){return se.makeAccountRequest("PUT",e,"orders/"+t,{price:n},o,r)},cancelOrder:function(e,t,n){return se.cancelOrderForAccount(se.selectedAccountId,e,t,n)},cancelOrderForAccount:function(e,t,n,o){
return se.makeAccountRequest("DELETE",e,"orders/"+t,null,n,o)},getPositions:function(e,t){return se.getPositionsForAccount(se.selectedAccountId,e,t)},getPositionsForAccount:function(e,t,n){return se.makeAccountRequest("GET",e,"positions/",null,t,n)},closeAllPositions:function(e,t){return se.closeAllPositionsForAccount(se.selectedAccountId,e,t)},closeAllPositionsForAccount:function(e,t,n){return se.makeAccountRequest("DELETE",e,"positions/",null,t,n)},getOpenPositions:function(e,t){return se.getOpenPositionsForAccount(se.selectedAccountId,e,t)},getOpenPositionsForAccount:function(e,t,n){return se.makeAccountRequest("GET",e,"positions/open",null,t,n)},getPositionById:function(e,t,n){return se.getPositionByIdForAccount(se.selectedAccountId,e,t,n)},getPositionByIdForAccount:function(e,t,n,o){return se.makeAccountRequest("GET",e,"positions/"+t,null,n,o)},reducePositionToAmount:function(e,t,n,o){return se.reducePositionToAmountForAccount(se.selectedAccountId,e,t,n,o)},reducePositionToAmountForAccount:function(e,t,n,o,r){var i={amount:n};return se.makeAccountRequest("PUT",e,"positions/"+t,i,o,r)},closePosition:function(e,t,n){return se.closePositionForAccount(se.selectedAccountId,e,t,n)},closePositionForAccount:function(e,t,n,o){return se.makeAccountRequest("DELETE",e,"positions/"+t,null,n,o)},addOrModifyProtections:function(e,t,n,o,r){return se.addOrModifyProtectionsForAccount(se.selectedAccountId,e,t,n,o,r)},addOrModifyProtectionsForAccount:function(e,t,n,o,r,i){var c={};return null!==n&&(c.takeprofit=n),null!==o&&(c.stoploss=o),se.makeAccountRequest("PUT",e,"positions/"+t+"/protections/",c,r,i)},cancelProtections:function(e,t,n){return se.cancelProtectionsForAccount(se.selectedAccountId,e,t,n)},cancelProtectionsForAccount:function(e,t,n,o){return se.makeAccountRequest("DELETE",e,"positions/"+t+"/protections/",null,n,o)},addOrModifyTakeProfit:function(e,t,n,o){return se.makeProtectionRequest("PUT",e,t,"TAKEPROFIT",n,o)},addOrModifyTakeProfitForAccount:function(e,t,n,o,r){return se.makeProtectionRequestForAccount("PUT",e,t,n,"TAKEPROFIT",o,r)},addOrModifyStopLoss:function(e,t,n,o){return se.makeProtectionRequest("PUT",e,t,"STOPLOSS",n,o)},addOrModifyStopLossForAccount:function(e,t,n,o,r){return se.makeProtectionRequestForAccount("PUT",e,t,n,"STOPLOSS",o,r)},cancelTakeProfit:function(e,t,n){return se.makeProtectionRequest("DELETE",e,0,"TAKEPROFIT",t,n)},cancelTakeProfitForAccount:function(e,t,n,o){return se.makeProtectionRequestForAccount("DELETE",e,t,0,"TAKEPROFIT",n,o)},cancelStopLoss:function(e,t,n){return se.makeProtectionRequest("DELETE",e,0,"STOPLOSS",t,n)},cancelStopLossForAccount:function(e,t,n,o){return se.makeProtectionRequestForAccount("DELETE",e,t,0,"STOPLOSS",n,o)},makeProtectionRequest:function(e,t,n,o,r,i){return se.makeProtectionRequestForAccount(e,se.selectedAccountId,t,n,o,r,i)},makeProtectionRequestForAccount:function(e,t,n,o,r,i,c){var a={price:o};return"DELETE"===e&&(a=null),se.makeAccountRequest(e,t,"positions/"+n+"/protections/"+r,a,i,c)},getPrices:function(e,t,n){return se.getPricesForAccount(se.selectedAccountId,e,t,n)},getPricesForAccount:function(e,n,o,r){var i={instrumentIds:n};if(g(e)||e!==se.selectedAccount.uniqueId)return se.makeAccountRequest("POST",e,"prices/",i,o,r);var c,a=new t.Deferred,u=T(n);return c=u.length?se.getInstrumentsFromIdsForAccount(e,u).then(function(){return se.makeAccountRequest("POST",e,"prices/",i)}):se.makeAccountRequest("POST",e,"prices/",i),c.then(function(e){a.resolve(e)},function(e){a.reject(e)}),B(a,o,r)},makeCandleRequest:function(e,n,o,r,i){var c={instrumentIds:n};"getQuotes"===e&&(c={symbols:n}),i&&(c=i);var a=t.ajax({type:"POST",crossDomain:!0,url:"https://candles-api.tradable.com/"+e,contentType:"application/json; charset=utf-8",data:JSON.stringify(c),dataType:"json"}),u=new t.Deferred;return a.then(function(e){return e.dailyClose?u.resolve(e.dailyClose):u.resolve(e)},function(e,t,n){return u.reject(e,t,n)}),B(u,o,r)},getLastDailyClose:function(e,t,n){return se.makeCandleRequest("dailyClose",e,t,n)},initializeWithToken:function(e,t,n,o,r){e&&t&&(se.accessToken=e,se.authEndpoint=t,u()&&(localStorage.setItem("accessToken:"+Y,se.accessToken),localStorage.setItem("authEndpoint:"+Y,se.authEndpoint),n&&(se.expirationTimeUTC=(new Date).getTime()+1e3*parseInt(n,10),localStorage.setItem("expirationTimeUTC:"+Y,se.expirationTimeUTC))));var i=se.getAccounts();return B(i,o,r)},reLogin:function(e,t){return se.reLoginForAccount(se.selectedAccount.uniqueId,e,t)},reLoginForAccount:function(e,t,n){var o={},r=se.makeAccountRequest("POST",e,"reLogin/",o).then(function(){se.initializingAccount||S(!0)});return B(r,t,n)},enableTrading:function(e,n,o,r){var i=new t.Deferred;se.log("Enabling Trading..."),M("embedStarting"),se.tradingEnabled=!1,se.lastSnapshot=void 0;var c=se.accounts.length;return se.initializeWithToken(e,n,o).then(function(){return R(r,c)}).then(function(){i.resolve()},function(e){i.reject(e)}),i}};se.log("Starting v_"+se.version),n(),se.getTokenValuesFromHashFragment=o;var de,le,fe=[],pe={},he=!1;e.trEmbJQ=trEmbJQ,e.tradable=se,e.tradableEmbed=se,"function"==typeof define&&define&&define.amd?define("tradable-core",[],se):"function"==typeof require&&"object"==typeof module&&module&&module.exports&&(module.exports=se)}(jsGlobalObject,trEmbJQ);