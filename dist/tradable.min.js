/******  Copyright 2016 Tradable ApS; @license MIT; v1.19.3  ******/
function isGreaterOrEqualMinVersion(e,t){return this.toNum=function(e){return parseInt(e,10)},this.highest=function(e,t){for(var n=e.split(".").map(this.toNum),o=t.split(".").map(this.toNum),r=0;r<n.length;r++)if(n[r]!==o[r])return n[r]>o[r]?e:t;return o.length>n.length?t:void 0},!("undefined"!=typeof highest(e,t)&&highest(e,t)===t)}"undefined"!=typeof console&&"undefined"!=typeof console.log||(console={log:function(){},warn:function(){}}),"undefined"==typeof jQuery?console.warn("tradable requires jQuery to run"):isGreaterOrEqualMinVersion(jQuery.fn.jquery,"2.1.4")||console.warn("tradable requires jQuery version 2.1.4 or above");var trEmbJQ=jQuery.noConflict(!0),jsGlobalObject="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:this;!function(e,t){"use strict";function n(){function e(e,t){t.tradingEnabled=!1,u()&&localStorage.setItem("tradingEnabled:"+N,!1);var n=o(e);return n.accessToken&&n.endPoint?(t.enableTrading(n.accessToken,n.endPoint,n.expiresIn),"osLaunch"===window.name&&window.close(),!0):!1}var n=!1,r=window.opener;if(r&&"osBrokerSignUp"===window.name)window.close();else if(r&&"osLaunch"===window.name){var c=window.location.hash;if(c){try{r.postMessage("replace your location","*"),n=e(c,r.tradable)}catch(i){n=!1}n||(n=e(c,X))}}else window.location.hash&&-1!==window.location.hash.indexOf("access_token")&&-1!==window.location.hash.indexOf("endpointURL")&&-1!==window.location.hash.indexOf("expires_in")?n=e(window.location.hash,X):X.tradingEnabled&&(O(),n=!0);n||(console.log("Initiating without authentication..."),t(document).ready(function(){E()}))}function o(e){var n={accessToken:void 0,endPoint:void 0,expiresIn:void 0},o=e.replace("#","").split("&");return t(o).each(function(e,t){var o=t.split("="),r=o[0],c=o[1];"access_token"===r?n.accessToken=c:"endpointURL"===r?n.endPoint=c:"expires_in"===r&&(n.expiresIn=c)}),n}function r(){var n="undefined"!=typeof e.tradableEmbedConfig?e.tradableEmbedConfig:e.tradableConfig;if("undefined"==typeof n){var o=0!==t("#tradable-embed").length?"#tradable-embed":0!==t("#tradable").length?"#tradable":"#tradable-api";n={appId:t(o).attr("data-app-id"),redirectURI:t(o).attr("data-redirect-uri"),customOAuthURL:t(o).attr("data-custom-oauth-url"),customOAuthHost:t(o).attr("data-custom-oauth-host")}}return n}function c(){var e=tradableConfig.redirectURI?tradableConfig.redirectURI:location.href;return encodeURIComponent(e)}function i(e){var t={},n=tradableConfig.customOAuthURL,o=tradableConfig.customOAuthHost,r="api.tradable.com/";N>2e5&&(r="api-staging.tradable.com/",console.log("Starting in staging mode...")),o&&(r=o);var c="https://"+r+"oauth/authorize?client_id="+N+"&scope=trade&response_type=token&redirect_uri="+e,i=n?n:c;return t.oauthHost=r,t.oauthURL=i,t}function a(){var e={};return e.token=localStorage.getItem("accessToken:"+N),e.authEndpoint=localStorage.getItem("authEndpoint:"+N),e.tradingEnabled=localStorage.getItem("tradingEnabled:"+N),e.expirationTimeUTC=localStorage.getItem("expirationTimeUTC:"+N),!e.tradingEnabled||e.authEndpoint&&e.token&&e.expirationTimeUTC||(e.tradingEnabled=!1,u()&&localStorage.setItem("tradingEnabled:"+N,e.tradingEnabled)),e}function u(){var e="test";try{return localStorage.setItem(e,"1"),localStorage.removeItem(e),!0}catch(t){return!1}}function s(e,t){var n=window.screenLeft?window.screenLeft:window.screenX,o=window.screenTop?window.screenTop:window.screenY,r=420,c=500,i=n+window.innerWidth/2-r/2,a=o+window.innerHeight/2-c/2;return window.open(e,t,"toolbar=no, titlebar=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+r+", height="+c+", top="+a+", left="+i)}function d(e,t){var n=!1;return X.tradingEnabled&&(X.tradingEnabled=!1,n=!0),A(),h().then(function(){return console.log("Instruments ready"),n&&(X.tradingEnabled=!0,C()),e&&"function"==typeof e?e(X.accounts):this},function(e){return t&&"function"==typeof t?t(e):this})}function l(e,t){return f(X.selectedAccountId,e,t)}function f(e,t,n){return X.makeAccountRequest("GET",e,"instruments/",null,t,n)}function p(){return"FULL_INSTRUMENT_LIST"===X.selectedAccount.instrumentRetrieval}function m(e){var n=!0;return t(X.accounts).each(function(t,o){o.uniqueId===e&&"FULL_INSTRUMENT_LIST"!==o.instrumentRetrieval&&(n=!1)}),n}function h(){var e=new t.Deferred;return p()?l().then(function(t){I(t),e.resolve(X.availableInstruments)},function(t){e.reject(t)}):(Y=[],X.searchInstruments("EUR").then(function(e){return g(e),X.searchInstruments("AUD")}).then(function(e){return g(e),X.searchInstruments("USD")}).then(function(e){return g(e),X.getPrices(Y)}).then(function(){e.resolve(X.availableInstruments)},function(t){e.reject(t)})),e}function g(e){var n=0;t(e).each(function(e,t){(6===t.symbol.length||7===t.symbol.length)&&16>n&&(Y.push(t.instrumentId),n++)})}function A(){X.availableCategories.splice(0,X.availableCategories.length),X.availableInstruments.splice(0,X.availableInstruments.length),X.availableSymbols.splice(0,X.availableSymbols.length),X.availableCurrencies.splice(0,X.availableCurrencies.length),$={}}function v(e){return"undefined"!=typeof $[e]}function I(e){function n(e){var n=["100","200","225","spx","h33","nas","u30","e50","f40","d30","e35","i40","z30","s30","uso","uko"];-1===t.inArray(e,X.availableCurrencies)&&-1===t.inArray(e,n)&&X.availableCurrencies.push(e)}t(e).each(function(e,o){if(!v(o.instrumentId)){X.availableInstruments.push(o),X.availableSymbols.push(o.symbol);var r=o.symbol.replace("/","");if(("FOREX"===o.type||"CFD"===o.type)&&6===r.length){var c=r.toLowerCase().substring(0,3),i=r.toLowerCase().substring(3,6);n(c),n(i)}-1===t.inArray(o.type,X.availableCategories)&&X.availableCategories.push(o.type),$[o.instrumentId]=!0}})}function b(e){var n=[];return t(e).each(function(e,t){v(t)||n.push(t)}),n}function y(){X.instrumentKeysForAccountUpdates.length&&X.instrumentKeysForAccountUpdates.splice(0,X.instrumentKeysForAccountUpdates.length)}function T(e,t){X.excludeCurrentAccount(),X.accounts.length>0?O():X.signOut(),e&&e(t)}function O(){console.log("Validating token..."),X.getAccounts().then(function(){X.enableTrading(X.accessToken,X.authEndpoint)},function(){k(!1)})}function P(e,n){var o=new t.Deferred;console.log("Accounts initialized");var r,c=localStorage.getItem("selectedAccount:"+N),i=X.accounts.length-1;return e&&X.accounts.length>n?r=X.accounts[i].uniqueId:c&&X.accountMap[c]?r=c:i>=0&&(r=X.accounts[i].uniqueId),y(),r?X.setSelectedAccount(r,function(){X.tradingEnabled||k(!0),o.resolve()},function(e){o.reject(e)}):(X.signOut(),o.reject()),o}function k(e){X.tradingEnabled=e,u()&&localStorage.setItem("tradingEnabled:"+N,X.tradingEnabled),E()}function E(){t(X.readyCallbacks).each(function(e,t){t()}),q("embedReady"),X.notifiedCallbacks=!0}function R(){if(X.tradingEnabled&&!Z&&(z.length>0||void 0!==typeof W.accountUpdated)){Z=!0;var e=[];t(X.instrumentKeysForAccountUpdates).each(function(n,o){var r=o.substring(0,o.indexOf(":"));-1===t.inArray(r,e)&&e.push(r)}),X.getSnapshot(e).then(function(e){return X.lastSnapshot=e,S(e)}).then(function(e){t.each(z,function(t,n){n(e)}),q("accountUpdated",e),Z=!1},function(){Z=!1})}}function S(e){var n=new t.Deferred;if(p())n.resolve(e);else{var o=[],r=function(e,t){v(t.instrumentId)||o.push(t.instrumentId)};t(e.positions.open).each(r),t(e.orders.pending).each(r),o.length?X.getInstrumentsFromIds(o).then(function(){n.resolve(e)}):n.resolve(e)}return n}function w(){k(!1),t(V).each(function(e,t){t()}),q("tokenExpired")}function F(e){t(Q).each(function(t,n){n(e)}),q("error",e)}function C(){t(B).each(function(e,t){t()}),q("accountSwitch")}function U(){k(!1),q("reLoginRequired")}function q(e,t){if(X.isEventValid(e)){if(void 0!==typeof W[e])for(var n in W[e])W[e].hasOwnProperty(n)&&("undefined"!=typeof t?W[e][n](t):W[e][n]())}else console.error("Careful, can't notify '"+e+"', it's an invalid event name")}function L(e,t,n){return t||n?e.then(function(e){return"function"==typeof t?t(e):void 0},function(e,t,o){return"function"==typeof n?n(e,t,o):void 0}):e.promise()}function M(){var e=new t.Deferred;if(X.selectedAccount.brokerId<0&&1===X.allAccounts.length)return e.resolve(),e;var n={tokenValue:X.accessToken};return X.makeOsRequest("internal","POST","","signOut",n).then(function(){e.resolve()},function(){e.reject()}),e}function x(e){var t,n,o=0;if(0===e.length)return o;for(t=0;t<e.length;t++)n=e.charCodeAt(t),o=(o<<5)-o+n,o&=o;return o}function D(){return-1!==navigator.userAgent.indexOf("MSIE")||/rv:11.0/i.test(navigator.userAgent)}e.tradableConfig=r();var N=tradableConfig.appId,_=c(),j=i(_),K=a(),G=["embedReady","accountUpdated","accountSwitch","tokenExpired","tokenWillExpire","reLoginRequired","error"],W={},B=[],z=[],J=[],V=[],H=[],Q=[],X={version:"1.19.3",app_id:N,oauth_host:j.oauthHost,auth_loc:j.oauthURL,login_loc:j.oauthURL+"&showLogin=true",approval_page_loc:j.oauthURL+"&showApproval=true",broker_signup_loc:"https://"+j.oauthHost+"brokerSignup?client_id="+N+"&redirect_uri="+_,auth_window:null,authEndpoint:K.authEndpoint,accessToken:K.token,tradingEnabled:K.tradingEnabled,expirationTimeUTC:K.expirationTimeUTC,notifiedCallbacks:!1,readyCallbacks:[],allAccounts:[],accounts:[],accountIdsToExclude:[],accountMap:{},selectedAccount:null,selectedAccountId:null,availableCategories:[],availableInstruments:[],availableSymbols:[],availableCurrencies:[],lastSnapshot:null,instrumentKeysForAccountUpdates:[],accountUpdateMillis:700,showApprovalPage:function(){X.openOAuthPage("APPROVAL",!0)},showApprovalPageInWindow:function(){X.openOAuthPage("APPROVAL",!1)},authenticate:function(e){X.tradingEnabled?O():X.openOAuthPage("AUTHENTICATE",!0,e)},authenticateWithWindow:function(e){X.openOAuthPage("AUTHENTICATE",!1,e)},showLoginPage:function(e){X.openOAuthPage("LOGIN",!0,e)},showLoginPageInWindow:function(e){X.openOAuthPage("LOGIN",!1,e)},showBrokerSignUpPage:function(){X.openOAuthPage("BROKER_SIGNUP",!0)},showBrokerSignUpPageInWindow:function(){X.openOAuthPage("BROKER_SIGNUP",!1)},openOAuthPage:function(e,t,n){var o="AUTHENTICATE"===e.toUpperCase()?X.auth_loc:"LOGIN"===e.toUpperCase()?X.login_loc:"APPROVAL"===e.toUpperCase()?X.approval_page_loc:"BROKER_SIGNUP"===e.toUpperCase()?X.broker_signup_loc:void 0;if(!o)throw"Choose a correct type: AUTHENTICATE, LOGIN, APPROVAL or BROKER_SIGNUP";if("undefined"!=typeof n&&(o=o+"&broker_id="+n),"undefined"!=typeof t&&t||D())location.href=o;else{var r="BROKER_SIGNUP"===e.toUpperCase()?"osBrokerSignUp":"osLaunch";X.auth_window=s(o,r)}},enableWithAccessToken:function(e,t,n){return X.enableTrading(e,t,n,!0)},signOut:function(){M(),u()&&(localStorage.removeItem("accessToken:"+N),localStorage.removeItem("authEndpoint:"+N),localStorage.removeItem("tradingEnabled:"+N),localStorage.removeItem("expirationTimeUTC:"+N)),X.tradingEnabled=!1,E()},isEventValid:function(e){return"string"==typeof e&&-1!==t.inArray(e,G)},on:function(e,t,n){if(!X.isEventValid(t))throw"Please provide a valid eventName: "+G;if(W[t]||(W[t]={}),"string"!=typeof e)throw"The given event namespace is invalid (needs to be a string)";if("undefined"!=typeof W[t][e])throw"The given event namespace is already taken, 'off' the event first to change it";if("function"!=typeof n)throw"Please provide a valid callback function";switch(t){case"embedReady":X.initEmbedReady(n);break;case"accountUpdated":X.initAccountUpdated();break;case"tokenWillExpire":X.initTokenWillExpire()}W[t][e]=n},off:function(e,t){if("undefined"==typeof t)for(var n in W)W.hasOwnProperty(n)&&e in W[n]&&W[n].hasOwnProperty(e)&&delete W[n][e];else X.isEventValid(t)&&W[t]&&e in W[t]&&delete W[t][e]},initEmbedReady:function(e){return X.notifiedCallbacks?e():void 0},onEmbedReady:function(e){if(!e||"function"!=typeof e)throw"The specified callback is not a function";X.readyCallbacks.push(e),X.initEmbedReady(e)},accountUpdateInterval:null,initAccountUpdated:function(){null===X.accountUpdateInterval&&(X.accountUpdateInterval=setInterval(R,X.accountUpdateMillis))},onAccountUpdated:function(e){if(!e||"function"!=typeof e)throw"The specified callback is not a function";X.initAccountUpdated();var n=x(e.toString());-1===t.inArray(n,J)&&(z.push(e),J.push(n))},setAccountUpdateFrequencyMillis:function(e){if(!(e&&e>0&&"number"==typeof e))throw"Please specify a valid update frequency";X.accountUpdateMillis=e,X.accountUpdateInterval&&(clearInterval(X.accountUpdateInterval),X.accountUpdateInterval=setInterval(R,X.accountUpdateMillis))},addSymbolToUpdates:function(e,t){console.warn("'addSymbolToUpdates' is now deprecated, 'addInstrumentIdToUpdates' should now be used instead."),X.addInstrumentIdToUpdates(e,t)},removeSymbolFromUpdates:function(e,t){console.warn("'removeSymbolFromUpdates' is now deprecated, 'removeInstrumentIdFromUpdates' should now be used instead."),X.removeInstrumentIdFromUpdates(e,t)},addInstrumentIdToUpdates:function(e,n){if(-1!==e.indexOf(":"))throw"It is not allowed to include a colon ':' in the updateClientId";var o=n+":"+e;-1===t.inArray(o,X.instrumentKeysForAccountUpdates)&&X.instrumentKeysForAccountUpdates.push(o)},removeInstrumentIdFromUpdates:function(e,n){var o=n+":"+e;X.instrumentKeysForAccountUpdates=t.grep(X.instrumentKeysForAccountUpdates,function(e){return e!==o})},onAccountSwitch:function(e){X.saveCallback(e,B)},onTokenExpired:function(e){X.saveCallback(e,V)},onError:function(e){X.saveCallback(e,Q)},saveCallback:function(e,n){e&&-1===t.inArray(e,n)&&n.push(e)},tokenWillExpireInterval:null,initTokenWillExpire:function(){function e(){var e=X.getRemainingTokenMillis();e&&e>0&&18e5>e&&(t(H).each(function(t,n){n(e)}),q("tokenWillExpire",e))}null===X.tokenWillExpireInterval&&(X.tokenWillExpireInterval=setInterval(e,3e5))},onTokenWillExpire:function(e){X.initTokenWillExpire(),-1===t.inArray(e,H)&&H.push(e)},getRemainingTokenMillis:function(){return X.expirationTimeUTC||console.log("You need to authenticate before calling this method"),X.expirationTimeUTC-(new Date).getTime()},makeOsRequest:function(e,n,o,r,c,i,a){var u,s="internal"===e?"":"v1/";"user"!==e&&"accounts"!==e?u="https://"+X.oauth_host:void 0!==o&&null!==o&&0===o.length?u=X.authEndpoint:X.accountMap[o]?u=X.accountMap[o].endpointURL:console.info("Please specify a valid accountId or method");var d=t.ajax({type:n,beforeSend:function(t){"internal"!==e&&t.setRequestHeader("Authorization","Bearer "+X.accessToken),t.setRequestHeader("x-tr-embed-sdk","js-"+X.version)},crossDomain:!0,xhrFields:{withCredentials:!0},url:o&&o.length>0?u+s+e+"/"+o+"/"+r:u+s+e+"/"+r,contentType:"application/json; charset=utf-8",data:c?JSON.stringify(c):void 0,dataType:"json"});return d.then(function(){},function(e){e.responseJSON&&(403!==e.responseJSON.httpStatus&&502!==e.responseJSON.httpStatus||(!X.initializingAccount&&X.isReLoginRequired(e)?U():w()),F(e.responseJSON))}),L(d,i,a)},makeAccountRequest:function(e,t,n,o,r,c){return X.makeOsRequest("accounts",e,t,n,o,r,c)},initializingAccount:!1,setSelectedAccount:function(e,t,n){return X.accountMap[e]?(X.lastSnapshot=void 0,X.selectedAccount=X.accountMap[e],X.selectedAccountId=e,console.log("New accountId is set"),X.initializingAccount=!0,d(function(){u()&&localStorage.setItem("selectedAccount:"+N,e),t&&t(),X.initializingAccount=!1},function(t){X.isReLoginRequired(t)?X.reLogin().then(function(){X.setSelectedAccount(e)},function(){T(n,t)}):502!==t.status&&500!==t.status&&403!==t.status||T(n,t),X.initializingAccount=!1})):void console.error("Can't set account id to: "+e)},isReLoginRequired:function(e){return!!e&&!!e.responseJSON&&403===e.responseJSON.httpStatus&&1005===e.responseJSON.code},excludeCurrentAccount:function(){var e=X.selectedAccountId,t=X.accounts.indexOf(X.selectedAccount);t>-1&&X.accounts.splice(t,1),delete X.accountMap[e],X.accountIdsToExclude.push(e)},getInstrumentFromSymbol:function(e){return e?X.getInstrumentForProperty(X.availableInstruments,"symbol",e):null},getInstrumentFromId:function(e){return e&&X.tradingEnabled?v(e)?X.getInstrumentForProperty(X.availableInstruments,"instrumentId",e):(console.warn("Instrument Id not found..."),null):null},getInstrumentFromBrokerageAccountSymbol:function(e){return X.getInstrumentForProperty(X.availableInstruments,"brokerageAccountSymbol",e)},getInstrumentForProperty:function(e,n,o){var r=null;return t(e).each(function(e,t){return t[n].toUpperCase()===o.toUpperCase()?(r=t,!1):void 0}),r},calculatePipDistance:function(e,t,n){var o=X.getInstrumentFromId(e);if(!o)throw"Instrument not found for the given instrumentId: "+e;var r=o.pipPrecision?o.pipPrecision:0,c=(t-n)*Math.pow(10,r),i=Math.round(10*c)/10;return Math.abs(i)},calculateExpectedProfitOrLoss:function(e,t,n){return Math.round(e*t*n*100)/100},calculatePositionSizeForRiskPercentage:function(e,t,n,o,r){return X.calculatePositionSize(e,t,!1,n,o,r)},calculatePositionSizeForRiskAmount:function(e,t,n,o,r){return X.calculatePositionSize(e,t,!0,n,o,r)},calculatePositionSize:function(e,t,n,o,r,c){var i=c;if(!i&&X.lastSnapshot)i=X.lastSnapshot.metrics.equity;else if(!c)throw"Please provide the equity or subscribe to account updates before calling calculatePositionSizeForAccount.";if(!n&&t>100)throw"Please provide a valid risk value: riskIsMoney is false but the provided risk is not a percentage..";var a=n?t:i*t/100,u=a/o/r,s=X.getInstrumentFromId(e);return s.multipleOfMinAmount&&(u=Math.floor(u/s.minAmount)*s.minAmount),u=Math.round(100*u)/100},getAccountById:function(e){return X.accountMap[e]},getUser:function(e,t){return X.makeOsRequest("user","GET","","",null,e,t)},getAppInfo:function(e,t){return X.makeOsRequest("apps","GET","",X.app_id,null,e,t)},getBrokers:function(e,t){return X.makeOsRequest("brokers","GET","","",null,e,t)},authenticateWithCredentials:function(e,n,o,r,c,i){var a=new t.Deferred;"function"==typeof r&&("function"==typeof c&&(i=c),c=r);var u={appId:X.app_id,brokerId:e,login:n,password:o};return"string"==typeof r&&(u.externalId=r),X.makeAuthenticationRequest(a,"authenticate",u),L(a,c,i)},createDemoAccount:function(e,n,o){var r=new t.Deferred,c={appId:X.app_id,type:e};return X.makeAuthenticationRequest(r,"createDemoAccount",c),L(r,n,o)},makeAuthenticationRequest:function(e,t,n){var o;return X.makeOsRequest(t,"POST","","",n).then(function(e){return o=e,X.enableTrading(e.apiTokenValue,e.apiEndpoint,e.expires)}).then(function(){e.resolve(o)},function(t){e.reject(t)})},createForexDemoAccount:function(e,t){return X.createDemoAccount("FOREX",e,t)},createStocksDemoAccount:function(e,t){return X.createDemoAccount("STOCKS",e,t)},refreshAuthentication:function(e,n,o,r){var c=new t.Deferred,i={refreshTokenValue:e};return n&&(i={refreshTokenValue:e,appSecret:n}),X.makeAuthenticationRequest(c,"refreshAuthentication",i),L(c,o,r)},getAccounts:function(e,n){var o=X.makeAccountRequest("GET","","",null).then(function(e){X.accounts.splice(0,X.accounts.length),X.allAccounts.splice(0,X.allAccounts.length),X.accountMap={},t(e.accounts).each(function(e,t){t.uniqueId&&"NA"!==t.uniqueId&&X.accountIdsToExclude.indexOf(t.uniqueId)<=-1&&(X.accounts.push(t),X.accountMap[t.uniqueId]=t),X.allAccounts.push(t)})});return L(o,e,n)},getCandles:function(e,t,n,o,r,c){return X.getCandlesForAccount(X.selectedAccountId,e,t,n,o,r,c)},getCandlesForAccount:function(e,t,n,o,r,c,i){var a={instrumentId:t,from:n,to:o,aggregation:r};return X.makeAccountRequest("POST",e,"candles/",a,c,i)},subscribedCandleId:void 0,lastReceivedCandle:void 0,startCandleUpdates:function(e,n,o,r){function c(){X.on("internalCandleUpdates","accountUpdated",function(n){var o=a(e,n.prices);if(X.lastReceivedCandle&&o&&o.bid){var c=JSON.stringify(t.extend({},X.lastReceivedCandle));if(i(o,u),c!==JSON.stringify(X.lastReceivedCandle)){var s=[];return s.push(X.lastReceivedCandle),r(s)}}})}function i(e,t){var n=e.bid;if(Date.now()-X.lastReceivedCandle.timestamp>=t){X.lastReceivedCandle.timestamp=X.lastReceivedCandle.timestamp+t;var o=X.lastReceivedCandle.close;X.lastReceivedCandle.open=o,X.lastReceivedCandle.high=o,X.lastReceivedCandle.low=o}X.lastReceivedCandle.close=n,n>X.lastReceivedCandle.high&&(X.lastReceivedCandle.high=n),n<X.lastReceivedCandle.low&&(X.lastReceivedCandle.low=n)}function a(e,n){var o=null;return t(n).each(function(t,n){return n.instrumentId===e?(o=n,!1):void 0}),o}X.stopCandleUpdates();var u=60*o*1e3;X.subscribedCandleId=e,X.addInstrumentIdToUpdates("internalCandleUpdates",X.subscribedCandleId),X.getCandles(e,n,Date.now(),o).then(function(e){return X.lastReceivedCandle=e.candles[e.candles.length-1],c(),r(e.candles)},function(e){F(e.responseJSON)})},stopCandleUpdates:function(){X.subscribedCandleId&&(X.removeInstrumentIdFromUpdates("internalCandleUpdates",X.subscribedCandleId),X.off("internalCandleUpdates"),X.subscribedCandleId=void 0,X.lastReceivedCandle=void 0)},getSnapshot:function(e,t,n){return X.getSnapshotForAccount(X.selectedAccountId,e,t,n)},getSnapshotForAccount:function(e,t,n,o){var r={instrumentIds:t,includeMarginFactors:!1};return X.makeAccountRequest("POST",e,"",r,n,o)},getInstrumentsFromIds:function(e,t,n){return X.getInstrumentsFromIdsForAccount(X.selectedAccountId,e,t,n)},getInstrumentsFromIdsForAccount:function(e,n,o,r){var c=new t.Deferred,i=[];m(e)||(i=b(n));var a=new t.Deferred;if(i.length){var u={instrumentIds:i};X.makeAccountRequest("POST",e,"instruments/",u).then(function(e){I(e.instruments),a.resolve(X.availableInstruments)},function(e){c.reject(e)})}else X.getOrResolveInstrumentsForAccountId(e,a,c);return a.then(function(e){var o=[];t(n).each(function(t,n){var r=X.getInstrumentForProperty(e,"instrumentId",n);r&&o.push(r)}),c.resolve({instruments:o})},function(e){c.reject(e)}),L(c,o,r)},getOrResolveInstrumentsForAccountId:function(e,t,n){X.selectedAccount&&e===X.selectedAccount.uniqueId?t.resolve(X.availableInstruments):f(e).then(function(e){t.resolve(e)},function(e){n.reject(e)})},searchInstruments:function(e,t,n){return X.searchInstrumentsForAccount(X.selectedAccountId,e,t,n)},searchInstrumentsForAccount:function(e,n,o,r){function c(e,n){var o=new RegExp(i(n),"i");return t.grep(e,function(e){return o.test(e.symbol)||o.test(e.brokerageAccountSymbol)||o.test(e.displayName)||o.test(e.type)})}function i(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function a(e){var n=t.extend({},e),o=["instrumentId","symbol","brokerageAccountSymbol","displayName","shortDescription","type"],r=[];for(var c in n)n.hasOwnProperty(c)&&t.inArray(c,o)<0&&r.push(c);return t(r).each(function(e,t){delete n[t]}),n}var u=new t.Deferred;if(m(e)){var s=new t.Deferred;X.getOrResolveInstrumentsForAccountId(e,s,u),s.then(function(e){var o=c(e,n),r=[];t(o).each(function(e,t){r.push(a(t))}),u.resolve(r)},function(e){u.reject(e)})}else{var d={query:n};n.length<2?u.resolve([]):X.makeAccountRequest("POST",e,"instrumentsearch/",d).then(function(e){u.resolve(e.instruments)},function(e){u.reject(e)})}return L(u,o,r)},getMetrics:function(e,t){return X.getMetricsForAccount(X.selectedAccountId,e,t)},getMetricsForAccount:function(e,t,n){return X.makeAccountRequest("GET",e,"metrics/",null,t,n)},getOrders:function(e,t){return X.getOrdersForAccount(X.selectedAccountId,e,t)},getOrdersForAccount:function(e,t,n){return X.makeAccountRequest("GET",e,"orders/",null,t,n)},placeMarketOrder:function(e,t,n,o,r){return X.placeOrder(e,0,t,n,"MARKET",o,r)},placeMarketOrderForAccount:function(e,t,n,o,r,c){return X.placeOrderForAccount(e,t,0,n,o,"MARKET",r,c)},placeLimitOrder:function(e,t,n,o,r,c){return X.placeOrder(e,t,n,o,"LIMIT",r,c)},placeLimitOrderForAccount:function(e,t,n,o,r,c,i){return X.placeOrderForAccount(e,t,n,o,r,"LIMIT",c,i)},placeStopOrder:function(e,t,n,o,r,c){return X.placeOrder(e,t,n,o,"STOP",r,c)},placeStopOrderForAccount:function(e,t,n,o,r,c,i){return X.placeOrderForAccount(e,t,n,o,r,"STOP",c,i)},placeOrder:function(e,t,n,o,r,c,i){return X.placeOrderForAccount(X.selectedAccountId,e,t,n,o,r,c,i)},placeOrderForAccount:function(e,t,n,o,r,c,i,a){var u={amount:t,price:n,side:o,instrumentId:r,type:c};return X.makeAccountRequest("POST",e,"orders/",u,i,a)},placeOrderWithProtections:function(e,t,n,o,r,c,i,a,u){return X.placeOrderWithProtectionsForAccount(X.selectedAccountId,e,t,n,o,r,c,i,a,u)},placeOrderWithProtectionsForAccount:function(e,t,n,o,r,c,i,a,u,s){console.warn("placeOrderWithProtections is deprecated and will eventually be removed, please use placeProtectedOrder or placeProtectedOrderForAccount instead.");var d={amount:t,price:n,side:o,instrumentId:r,type:c};return i&&(d.takeProfitDistance=i),a&&(d.stopLossDistance=a),X.makeAccountRequest("POST",e,"orders/",d,u,s)},placeProtectedOrder:function(e,t,n,o,r,c,i,a,u,s){return X.placeProtectedOrderForAccount(X.selectedAccount.uniqueId,e,t,n,o,r,c,i,a,u,s)},placeProtectedOrderForAccount:function(e,n,o,r,c,i,a,u,s,d,l){X.validateOrderParams(i,o,s,a,u);var f={amount:n,price:o,side:r,instrumentId:c,type:i},p="MARKET"===i?s:o;return t.extend(f,X.getOrderProtections(e,a,u,p)),X.makeAccountRequest("POST",e,"orders/",f,d,l)},validateOrderParams:function(e,t,n,o,r){if("MARKET"===e){if(!(!o&&!r||"number"==typeof n&&n))throw"MARKET orders require a valid 'currentBidOrAskPrice'";if(0!==t)throw"The price for MARKET orders must be 0"}else if("MARKET"!==e&&("number"!=typeof t||!t))throw"LIMIT and STOP orders require a valid order price"},modifyProtectedOrder:function(e,t,n,o,r,c,i){return X.modifyProtectedOrderForAccount(X.selectedAccount.uniqueId,e,t,n,o,r,c,i)},modifyProtectedOrderForAccount:function(e,n,o,r,c,i,a,u){var s=o&&o!==n.price?o:n.price,d=n.price!==s?{price:s}:{},l="MARKET"===n.type?i:s,f=X.getOrderProtections(e,r,c,l);return X.verifyProtectionModification(n,f,"takeProfit"),X.verifyProtectionModification(n,f,"stopLoss"),t.extend(d,f),X.makeAccountRequest("PUT",e,"orders/"+n.id,d,a,u)},verifyProtectionModification:function(e,t,n){(t[n]===e[n]||e[n]&&t[n]&&t[n].value===e[n].value&&t[n].entryType===e[n].entryType)&&delete t[n]},getOrderProtections:function(e,n,o,r){function c(e,t,n){return null===e?e:{entryType:n,value:"DISTANCE"===n?Math.abs(t-e):e}}var i=X.accountMap[e],a=i.protectionEntryTypes.entryTypes,u={};if(a.length){var s=-1!==t.inArray("ABSOLUTE",a)?"ABSOLUTE":"DISTANCE";"undefined"!=typeof n&&(u.takeProfit=c(n,r,s)),"undefined"!=typeof o&&(u.stopLoss=c(o,r,s))}return u},cancelTakeProfitOnOrder:function(e,t,n){return X.cancelTakeProfitOnOrderForAccount(X.selectedAccount.uniqueId,e,t,n)},cancelTakeProfitOnOrderForAccount:function(e,t,n,o){return X.makeAccountRequest("PUT",e,"orders/"+t,{takeProfit:null},n,o)},cancelStopLossOnOrder:function(e,t,n){return X.cancelStopLossOnOrderForAccount(X.selectedAccount.uniqueId,e,t,n)},cancelStopLossOnOrderForAccount:function(e,t,n,o){return X.makeAccountRequest("PUT",e,"orders/"+t,{stopLoss:null},n,o)},getPendingOrders:function(e,t){return X.getPendingOrdersForAccount(X.selectedAccountId,e,t)},getPendingOrdersForAccount:function(e,t,n){return X.makeAccountRequest("GET",e,"orders/pending",null,t,n)},getOrderById:function(e,t,n){return X.getOrderByIdForAccount(X.selectedAccountId,e,t,n)},getOrderByIdForAccount:function(e,t,n,o){return X.makeAccountRequest("GET",e,"orders/"+t,null,n,o)},modifyOrderPrice:function(e,t,n,o){return X.modifyOrderPriceForAccount(X.selectedAccountId,e,t,n,o)},modifyOrderPriceForAccount:function(e,t,n,o,r){return X.makeAccountRequest("PUT",e,"orders/"+t,{price:n},o,r)},cancelOrder:function(e,t,n){return X.cancelOrderForAccount(X.selectedAccountId,e,t,n)},cancelOrderForAccount:function(e,t,n,o){return X.makeAccountRequest("DELETE",e,"orders/"+t,null,n,o)},getPositions:function(e,t){return X.getPositionsForAccount(X.selectedAccountId,e,t)},getPositionsForAccount:function(e,t,n){return X.makeAccountRequest("GET",e,"positions/",null,t,n)},closeAllPositions:function(e,t){return X.closeAllPositionsForAccount(X.selectedAccountId,e,t)},closeAllPositionsForAccount:function(e,t,n){return X.makeAccountRequest("DELETE",e,"positions/",null,t,n)},getOpenPositions:function(e,t){return X.getOpenPositionsForAccount(X.selectedAccountId,e,t)},getOpenPositionsForAccount:function(e,t,n){return X.makeAccountRequest("GET",e,"positions/open",null,t,n)},getPositionById:function(e,t,n){return X.getPositionByIdForAccount(X.selectedAccountId,e,t,n)},getPositionByIdForAccount:function(e,t,n,o){return X.makeAccountRequest("GET",e,"positions/"+t,null,n,o)},reducePositionToAmount:function(e,t,n,o){return X.reducePositionToAmountForAccount(X.selectedAccountId,e,t,n,o)},reducePositionToAmountForAccount:function(e,t,n,o,r){var c={amount:n};return X.makeAccountRequest("PUT",e,"positions/"+t,c,o,r)},closePosition:function(e,t,n){return X.closePositionForAccount(X.selectedAccountId,e,t,n)},closePositionForAccount:function(e,t,n,o){return X.makeAccountRequest("DELETE",e,"positions/"+t,null,n,o)},addOrModifyProtections:function(e,t,n,o,r){return X.addOrModifyProtectionsForAccount(X.selectedAccountId,e,t,n,o,r)},addOrModifyProtectionsForAccount:function(e,t,n,o,r,c){var i={};return null!==n&&(i.takeprofit=n),null!==o&&(i.stoploss=o),X.makeAccountRequest("PUT",e,"positions/"+t+"/protections/",i,r,c)},cancelProtections:function(e,t,n){return X.cancelProtectionsForAccount(X.selectedAccountId,e,t,n)},cancelProtectionsForAccount:function(e,t,n,o){return X.makeAccountRequest("DELETE",e,"positions/"+t+"/protections/",null,n,o)},addOrModifyTakeProfit:function(e,t,n,o){return X.makeProtectionRequest("PUT",e,t,"TAKEPROFIT",n,o)},addOrModifyTakeProfitForAccount:function(e,t,n,o,r){return X.makeProtectionRequestForAccount("PUT",e,t,n,"TAKEPROFIT",o,r)},addOrModifyStopLoss:function(e,t,n,o){return X.makeProtectionRequest("PUT",e,t,"STOPLOSS",n,o)},addOrModifyStopLossForAccount:function(e,t,n,o,r){return X.makeProtectionRequestForAccount("PUT",e,t,n,"STOPLOSS",o,r)},cancelTakeProfit:function(e,t,n){return X.makeProtectionRequest("DELETE",e,0,"TAKEPROFIT",t,n)},cancelTakeProfitForAccount:function(e,t,n,o){return X.makeProtectionRequestForAccount("DELETE",e,t,0,"TAKEPROFIT",n,o)},cancelStopLoss:function(e,t,n){return X.makeProtectionRequest("DELETE",e,0,"STOPLOSS",t,n)},cancelStopLossForAccount:function(e,t,n,o){return X.makeProtectionRequestForAccount("DELETE",e,t,0,"STOPLOSS",n,o)},makeProtectionRequest:function(e,t,n,o,r,c){return X.makeProtectionRequestForAccount(e,X.selectedAccountId,t,n,o,r,c)},makeProtectionRequestForAccount:function(e,t,n,o,r,c,i){var a={price:o};return"DELETE"===e&&(a=null),X.makeAccountRequest(e,t,"positions/"+n+"/protections/"+r,a,c,i)},getPrices:function(e,t,n){return X.getPricesForAccount(X.selectedAccountId,e,t,n)},getPricesForAccount:function(e,n,o,r){var c={instrumentIds:n};if(m(e)||e!==X.selectedAccount.uniqueId)return X.makeAccountRequest("POST",e,"prices/",c,o,r);var i,a=new t.Deferred,u=b(n);return i=u.length?X.getInstrumentsFromIdsForAccount(e,u).then(function(){return X.makeAccountRequest("POST",e,"prices/",c)}):X.makeAccountRequest("POST",e,"prices/",c),i.then(function(e){a.resolve(e)},function(e){a.reject(e)}),L(a,o,r)},makeCandleRequest:function(e,n,o,r,c){var i={instrumentIds:n};"getQuotes"===e&&(i={symbols:n}),c&&(i=c);var a=t.ajax({type:"POST",crossDomain:!0,url:"https://candles-api.tradable.com/"+e,contentType:"application/json; charset=utf-8",data:JSON.stringify(i),dataType:"json"});if(o||r)return a.then(function(e){return"function"==typeof o?o(e.dailyClose?e.dailyClose:e):void 0},function(e,t,n){return"function"==typeof r?r(e,t,n):void 0});var u=new t.Deferred;return a.then(function(e){return e.dailyClose?u.resolve(e.dailyClose):u.resolve(e)},function(e,t,n){return u.reject(e,t,n)}),"undefined"!=typeof Promise&&-1!==Promise.toString().indexOf("[native code]")?Promise.resolve(u.promise()):u.promise()},getLastDailyClose:function(e,t,n){return X.makeCandleRequest("dailyClose",e,t,n)},initializeWithToken:function(e,t,n,o,r){e&&t&&(X.accessToken=e,X.authEndpoint=t,u()&&(localStorage.setItem("accessToken:"+N,X.accessToken),localStorage.setItem("authEndpoint:"+N,X.authEndpoint),n&&(X.expirationTimeUTC=(new Date).getTime()+1e3*parseInt(n,10),localStorage.setItem("expirationTimeUTC:"+N,X.expirationTimeUTC))));var c=X.getAccounts();return L(c,o,r)},reLogin:function(e,t){return X.reLoginForAccount(X.selectedAccount.uniqueId,e,t);
},reLoginForAccount:function(e,t,n){var o={},r=X.makeAccountRequest("POST",e,"reLogin/",o).then(function(){k(!0)});return L(r,t,n)},enableTrading:function(e,n,o,r){var c=new t.Deferred;console.log("Enabling Trading..."),X.tradingEnabled=!1,X.lastSnapshot=void 0;var i=X.accounts.length;return X.initializeWithToken(e,n,o).then(function(){return P(r,i)}).then(function(){c.resolve()},function(e){c.reject(e)}),c}};n();var Y=[],$={},Z=!1;e.trEmbJQ=trEmbJQ,e.tradable=X,e.tradableEmbed=X,"function"==typeof require&&"object"==typeof module&&module&&module.exports&&(module.exports=X)}(jsGlobalObject,trEmbJQ);